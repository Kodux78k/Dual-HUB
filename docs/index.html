<!doctype html>
<html lang="pt-BR">
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
<link rel="manifest" href="./manifest.json"/>
<title>Dual Hub — Nebula Pro</title>
<style>
  /*
    Dual Hub – Nebula Pro

    A simple progressive web‑app launcher. Apps are read from
    the JSON file at ./apps/apps.json and rendered as cards on
    the home page. Clicking a card will either embed the page in
    an iframe or open it in a new tab depending on the user’s
    preference. The current app and its state are persisted in
    localStorage under the key “dual.stack”. User preferences
    (selected model and default open mode) are persisted under
    “dual.brain.pref”.

    Styles are inspired by the Nebula Pro aesthetic: soft
    gradients for the background, rounded panels, subtle glass
    effects and pastel accent colours. See the other HTML files
    in this package for examples of how to build pages to match
    this look and feel.
  */
  :root{
    --font: 'Inter', 'JetBrains Mono', system-ui, -apple-system, Segoe UI, Roboto, 'Helvetica Neue', Arial, sans-serif;
    --bg-a:#ff52e5; --bg-b:#00c5e5;
    --ink:#eef3ff; --ink-weak:#a9b3c9;
    --panel:#0d0f15cc; --panel-strong:#0d0f15f2;
    --accent:#9d7aff; --accent-2:#39ffb6;
    --radius:22px;
    --shadow:0 10px 30px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.04);
  }
  *{ box-sizing:border-box; }
  html,body{ height:100%; margin:0; }
  body{
    font:500 16px/1.4 var(--font);
    color:var(--ink);
    background: radial-gradient(120% 120% at 0% 0%, var(--bg-a), transparent 50%),
                radial-gradient(120% 120% at 100% 0%, var(--bg-b), #0b0e14 60%);
  }
  a{ color:inherit; text-decoration:none; }

  .app{ min-height:100%; display:flex; flex-direction:column; gap:12px; padding:clamp(12px,2vh,20px); }
  .header{ display:flex; align-items:center; justify-content:space-between; padding:12px 14px; border-radius:var(--radius); background:var(--panel-strong); box-shadow:var(--shadow); }
  .hrow{ display:flex; align-items:center; gap:10px; }
  .title{ font-weight:800; letter-spacing:.4px; font-size:20px; }
  .badge{ font-size:12px; color:var(--ink-weak); padding:3px 8px; border-radius:999px; background:#ffffff14; }
  .icon{ display:inline-flex; width:22px; height:22px; }
  .icon>img{ width:100%; height:100%; filter:invert(99%) sepia(2%) saturate(232%) hue-rotate(180deg) brightness(105%) contrast(98%); }
  .panel{ background:var(--panel); border-radius:var(--radius); box-shadow:var(--shadow); padding:14px; backdrop-filter: blur(10px); }
  .grid{ display:grid; grid-template-columns:repeat(auto-fill,minmax(120px,1fr)); gap:12px; }
  .appcard{ background:#ffffff10; border-radius:16px; padding:12px; display:flex; flex-direction:column; gap:8px; align-items:center; text-align:center; transition:transform .15s ease; cursor:pointer; }
  .appcard:hover{ transform:scale(1.05); }
  .appcard .icon{ width:32px; height:32px; }
  .nav{ position:sticky; bottom:0; margin-top:auto; display:grid; grid-template-columns:repeat(3,1fr); gap:10px; }
  .tab{ background:var(--panel-strong); border-radius:18px; text-align:center; padding:10px 6px; display:block; }
  .tab .icon{ width:20px; height:20px; display:block; margin:0 auto 4px; }
  .btn{ appearance:none; border:none; color:var(--ink); background:#ffffff10; padding:12px 14px; border-radius:14px; width:100%; cursor:pointer; }
  .select{ appearance:none; border:none; color:var(--ink); background:#ffffff10; padding:12px 14px; border-radius:14px; width:100%; }
  .toggle{ display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:8px; }
  .toggle input{ appearance:none; width:44px; height:24px; background:#ffffff24; border-radius:999px; position:relative; cursor:pointer; }
  .toggle input:checked{ background:linear-gradient(90deg, var(--accent), var(--accent-2)); }
  .toggle input::after{ content:''; position:absolute; width:18px; height:18px; top:3px; left:3px; border-radius:50%; background:#fff; transition:.2s; }
  .toggle input:checked::after{ left:23px; }
  .viewer{ position:fixed; inset:0; display:none; flex-direction:column; padding:14px; z-index:1000; }
  .viewer.show{ display:flex; }
  .vhead{ display:flex; align-items:center; justify-content:space-between; background:var(--panel-strong); border-radius:18px; padding:10px 12px; box-shadow:var(--shadow); }
  .vbody{ flex:1; margin-top:10px; background:#00000055; border-radius:18px; overflow:hidden; }
  .vbody iframe{ border:0; width:100%; height:100%; background:#0b0e14; }
  .minibadge{ position:fixed; right:14px; bottom:88px; background:linear-gradient(180deg,#ffffff26,#00000040); color:var(--ink); padding:10px 12px; border-radius:999px; display:none; align-items:center; gap:8px; backdrop-filter:blur(8px); box-shadow:var(--shadow); z-index:1001; }
  .minibadge.show{ display:flex; }
  .loader{ position:fixed; inset:0; display:none; align-items:center; justify-content:center; background:#00000060; z-index:1002; }
  .loader.show{ display:flex; }
  .spinner{ width:44px; height:44px; border:3px solid #ffffff30; border-top-color:#fff; border-radius:50%; animation:spin .8s linear infinite; }
  @keyframes spin{ to{ transform:rotate(360deg); } }
</style>
<body>
<div class="app">
  <!-- Header -->
  <div class="header">
    <div class="hrow">
      <span class="icon"><img src="icons/others/apps.svg" alt="Hub"></span>
      <div class="title">Dual Hub</div>
      <span class="badge">Nebula&nbsp;Pro</span>
    </div>
    <span class="icon"><img src="icons/others/profile.svg" alt="Perfil"></span>
  </div>

  <!-- Preferences Panel -->
  <div class="panel">
    <div class="toggle">
      <span>Modelo (OpenRouter)</span>
      <select id="modelSel" class="select" style="max-width:60%">
        <option value="openrouter/auto">openrouter/auto</option>
        <option value="anthropic/claude-3.5-sonnet">claude-3.5-sonnet</option>
        <option value="openai/gpt-4o-mini">gpt-4o-mini</option>
        <option value="mistralai/mistral-large">mistral-large</option>
      </select>
    </div>
    <div class="toggle">
      <span>Abrir em nova aba por padrão</span>
      <input type="checkbox" id="openNew"/>
    </div>
  </div>

  <!-- Apps Grid -->
  <div class="panel">
    <div id="appsGrid" class="grid"></div>
  </div>

  <!-- Navigation (optional) -->
  <div class="nav">
    <a class="tab" href="#"><span class="icon"><img src="icons/others/home.svg" alt="Home"></span>Home</a>
    <a class="tab" href="html/brain.html"><span class="icon"><img src="icons/others/brain.svg" alt="Brain"></span>Brain</a>
    <a class="tab" href="#apps"><span class="icon"><img src="icons/others/apps.svg" alt="Apps"></span>Apps</a>
  </div>
</div>

<!-- Viewer overlay for embedded apps -->
<div id="viewer" class="viewer" aria-hidden="true">
  <div class="vhead">
    <div class="hrow">
      <button id="vBack" class="btn" style="width:auto"><span class="icon"><img src="icons/others/arrow-left.svg" alt="Voltar"></span>Hub</button>
      <span id="vTitle" class="badge"></span>
    </div>
    <div class="hrow">
      <button id="vMin" class="btn" style="width:auto"><span class="icon"><img src="icons/others/minimize.svg" alt="Minimizar"></span>Minimizar</button>
      <button id="vNew" class="btn" style="width:auto"><span class="icon"><img src="icons/others/opennew.svg" alt="Nova aba"></span>Novo</button>
      <button id="vClose" class="btn" style="width:auto"><span class="icon"><img src="icons/others/x.svg" alt="Fechar"></span>Fechar</button>
    </div>
  </div>
  <div class="vbody">
    <iframe id="frame" sandbox="allow-scripts allow-forms allow-same-origin"></iframe>
  </div>
</div>
<div id="badge" class="minibadge"><span class="icon"><img src="icons/others/apps.svg" alt="Reabrir"></span>Reabrir App</div>
<div id="loader" class="loader"><div class="spinner"></div></div>

<script>
  // Helpers for persistent storage
  const LS = (k, v) => v === undefined ? JSON.parse(localStorage.getItem(k) || "null") : localStorage.setItem(k, JSON.stringify(v));

  const grid    = document.getElementById('appsGrid');
  const viewer  = document.getElementById('viewer');
  const frame   = document.getElementById('frame');
  const badge   = document.getElementById('badge');
  const loader  = document.getElementById('loader');
  const vBack   = document.getElementById('vBack');
  const vMin    = document.getElementById('vMin');
  const vClose  = document.getElementById('vClose');
  const vNew    = document.getElementById('vNew');
  const vTitle  = document.getElementById('vTitle');
  const modelSel= document.getElementById('modelSel');
  const openNew = document.getElementById('openNew');

  function savePrefs(){ LS('dual.brain.pref', { model: modelSel.value, openNew: openNew.checked }); }
  function loadPrefs(){ const p = LS('dual.brain.pref') || { model:'openrouter/auto', openNew:false }; modelSel.value = p.model; openNew.checked = p.openNew; }
  modelSel.addEventListener('change', savePrefs);
  openNew.addEventListener('change', savePrefs);

  function showLoader(on){ loader.classList[on?'add':'remove']('show'); }
  function showViewer(on){ viewer.classList[on?'add':'remove']('show'); viewer.setAttribute('aria-hidden', (!on).toString()); }

  function openApp(app){
    // Decide whether to open in a new tab
    if(app.openInNew || openNew.checked){
      window.open(app.url, '_blank');
      return;
    }
    vTitle.textContent = app.name;
    showViewer(true);
    showLoader(true);
    frame.src = app.url;
    frame.onload = () => showLoader(false);
    LS('dual.stack', { active: app, minimized: false });
  }
  function closeViewer(){
    frame.src = 'about:blank';
    showViewer(false);
    LS('dual.stack', { active: null, minimized: false });
  }
  vBack.onclick  = closeViewer;
  vClose.onclick = closeViewer;
  vMin.onclick   = () => {
    showViewer(false);
    badge.classList.add('show');
    const st = LS('dual.stack') || {};
    st.minimized = true;
    LS('dual.stack', st);
  };
  badge.onclick  = () => {
    badge.classList.remove('show');
    const st = LS('dual.stack') || {};
    if(st.active){ openApp(st.active); }
    st.minimized = false;
    LS('dual.stack', st);
  };
  vNew.onclick   = () => {
    const st = LS('dual.stack') || {};
    if(st.active) window.open(st.active.url, '_blank');
  };

  async function loadApps(){
    showLoader(true);
    try{
      // Read remote apps from apps.json
      const res = await fetch('apps/apps.json?ts=' + Date.now());
      const apps = await res.json();
      // Read any locally uploaded apps from localStorage (see brain.html)
      const localApps = LS('dual.localApps') || [];
      grid.innerHTML = '';
      [...apps, ...localApps].forEach(app => {
        const card = document.createElement('button');
        card.className = 'appcard';
        const iconKey = app.iconKey || app.key || 'apps';
        const iconSrc = app.icon ? app.icon : ('icons/others/' + iconKey + '.svg');
        card.innerHTML = `
          <span class="icon"><img src="${iconSrc}" alt=""></span>
          <strong>${app.name}</strong>
        `;
        card.onclick = () => openApp(app);
        grid.appendChild(card);
      });
    } catch(e){
      grid.innerHTML = '<div style="opacity:.7">Erro ao carregar apps.json</div>';
    } finally{
      showLoader(false);
    }
  }

  loadPrefs();
  loadApps();
  // Restore open app from stack
  const st = LS('dual.stack') || {};
  if(st.minimized) badge.classList.add('show');
  if(st.active && !st.minimized){ openApp(st.active); }

  // Register the service worker for offline capability
  if('serviceWorker' in navigator){
    navigator.serviceWorker.register('./service-worker.js').catch(err => {
      console.warn('SW registration failed', err);
    });
  }
</script>
</body>
</html>