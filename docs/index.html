<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Brava Master Blaster — UNO → DUAL → TRINITY</title>
  <meta name="theme-color" content="#0a0b10" />
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;800&display=swap" rel="stylesheet"/>
  <style>
    /* =================== MOBILE-FIRST VERTICAL HARD-LOCK =================== */
    :root{
      --bg0:#07080d; --bg1:#0d1020;
      --nebA:#7a3cff; --nebB:#00e5ff; /* Nebula roxo→ciano */
      --txt:#eaf2ff; --muted:#a6b0c0;
      --ringC:rgba(255,255,255,.16);
      --glass:rgba(255,255,255,.06);
      --glass2:rgba(255,255,255,.10);
      --blur:blur(12px);
      --radius:18px;
      --shadow:0 18px 60px rgba(0,0,0,.55), inset 0 0 80px rgba(255,255,255,.04);
      --size-orb:min(62vw, 420px);
      --ease:cubic-bezier(.2,.8,.2,1);
      --ok:#33e08a; --warn:#ffd35a; --err:#ff6b6b;
      --line:1px solid rgba(255,255,255,.12);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:Montserrat,Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      color:var(--txt);
      background: radial-gradient(140% 120% at 50% 0%, #14183a 0%, #0c0f22 55%, #07080d 100%);
      -webkit-font-smoothing:antialiased; overflow:hidden;
    }

    /* =========== HUD mini (cena ativa) =========== */
    .scene-indicator{position:fixed; top:8px; left:50%; transform:translateX(-50%);
      display:flex; gap:8px; align-items:center; z-index:1200;
      background:rgba(255,255,255,.08); border:1px solid rgba(255,255,255,.22);
      padding:6px 10px; border-radius:999px; backdrop-filter:var(--blur); -webkit-backdrop-filter:var(--blur);
      box-shadow:var(--shadow); font-size:12px; letter-spacing:.3px; opacity:.0; pointer-events:none; transition:opacity .25s var(--ease), transform .25s var(--ease)}
    .scene-indicator.show{ opacity:1; pointer-events:auto; transform:translateX(-50%) translateY(0) }
    .scene-indicator .label{ color:#eaf2ff }
    .scene-indicator .reset{ appearance:none; border:1px solid rgba(255,255,255,.18); background:rgba(255,255,255,.06); color:var(--txt); padding:4px 8px; border-radius:999px; cursor:pointer; }
    .scene-indicator .reset:active{ transform:scale(.97) }

    /* =========== Stage / Orb =========== */
    .stage{position:relative; width:100%; height:100%; display:grid; place-items:center; padding:20px}
    .orb-scene{position:relative; width:min(680px,88vw); height:min(680px,88vw); display:grid; place-items:center; z-index:10}
    .orb-wrap{position:relative; width:var(--size-orb); height:var(--size-orb); display:grid; place-items:center; filter:drop-shadow(0 30px 60px rgba(0,0,0,.65)); z-index:40; cursor:pointer}

    /* ORBE — versão leve (CSS layers) */
    .orb{position:absolute; inset:0; border-radius:50%;
      background:
        radial-gradient(32% 32% at 36% 34%, rgba(255,255,255,.95) 0%, rgba(255,255,255,.25) 36%, rgba(255,255,255,0) 68%),
        radial-gradient(70% 70% at 62% 64%, var(--nebB) 0%, rgba(0,0,0,0) 70%),
        radial-gradient(72% 72% at 45% 55%, var(--nebA) 0%, rgba(0,0,0,0) 72%);
      box-shadow:0 0 40px 12px rgba(0,229,255,.22) inset, 0 0 32px 12px rgba(122,60,255,.20);
      animation:pulse 3.6s ease-in-out infinite;
    }
    @keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.03)}}
    .orb-glow{position:absolute; inset:-10%; border-radius:50%; pointer-events:none;
      background:radial-gradient(60% 60% at 50% 50%, rgba(122,60,255,.18), rgba(0,229,255,.14) 45%, rgba(0,0,0,0) 70%);
      filter:blur(18px); opacity:.95; transition:opacity .6s var(--ease), transform .6s var(--ease)}
    .orbe-label{position:absolute;bottom:-42px;font-weight:800;opacity:.9;letter-spacing:.6px;color:#eaf2ff;text-shadow:0 1px 0 rgba(0,0,0,.5)}
    .call{position:absolute; bottom:26px; left:50%; transform:translateX(-50%); color:var(--muted); font-size:12px; letter-spacing:.3px; opacity:.9; white-space:nowrap; pointer-events:none; transition:opacity .35s var(--ease)}

    /* =========== HUD v11->v12 (opções ao redor do orbe) =========== */
    .options { position:absolute; inset:0; pointer-events:none; z-index:50; }
    .opt{ position:absolute; width:64px; height:64px; border-radius:16px; border:1px solid var(--ringC);
      background:var(--glass); box-shadow:var(--shadow); backdrop-filter:var(--blur); -webkit-backdrop-filter:var(--blur);
      display:grid; place-items:center; transition:transform .18s ease, opacity .4s ease; opacity:0; pointer-events:none }
    .opt svg{ width:28px; height:28px; stroke:#deebff; stroke-width:2; fill:none; stroke-linecap:round; stroke-linejoin:round }
    .opt .lab{ position:absolute; bottom:-20px; font-size:11px; color:var(--muted) }
    .options.active .opt{ opacity:1; pointer-events:auto }
    .opt:active{ transform:scale(.98) }
    /* posições iguais às usadas nas v11→v12 */
    .opt.fenda    { top:  calc(50% - (var(--size-orb))/2 - 18px - 64px); left: calc(50% - 64px - 18px) }
    .opt.sigilo   { top:  calc(50% - (var(--size-orb))/2 - 18px - 64px); left: calc(50% + 18px) }
    .opt.chaves   { top:  calc(50% + (var(--size-orb))/2 + 18px);        left: calc(50% - 64px - 18px) }
    .opt.playlist { top:  calc(50% + (var(--size-orb))/2 + 18px);        left: calc(50% + 18px) }
    @media(min-width:768px){ .opt{width:72px;height:72px} .opt svg{width:30px;height:30px}
      .opt.fenda{top:calc(50% - (var(--size-orb))/2 - 22px - 72px); left:calc(50% - 72px - 22px)}
      .opt.sigilo{top:calc(50% - (var(--size-orb))/2 - 22px - 72px); left:calc(50% + 22px)}
      .opt.chaves{top:calc(50% + (var(--size-orb))/2 + 22px); left:calc(50% - 72px - 22px)}
      .opt.playlist{top:calc(50% + (var(--size-orb))/2 + 22px); left:calc(50% + 22px)} }

    /* =========== Backdrop + Card (módulos) =========== */
    .backdrop{position:fixed; inset:0; background:rgba(4,6,10,.25); -webkit-backdrop-filter:blur(10px); backdrop-filter:blur(10px); display:none; z-index:9; opacity:0; transition:opacity .25s var(--ease)}
    .backdrop.active{display:block; opacity:1}
    .card{position:fixed; inset:24px 16px; border-radius:var(--radius); border:var(--line);
      background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02)); box-shadow:0 30px 80px rgba(0,0,0,.6), inset 0 0 80px rgba(255,255,255,.04);
      display:none; z-index:10; transform:translateY(12px) scale(.985); opacity:0; transition:transform .28s var(--ease), opacity .28s var(--ease); overflow:hidden }
    .card.active{display:block; transform:translateY(0) scale(1); opacity:1}
    .card.min .content{display:none}
    .card header{display:flex; align-items:center; justify-content:space-between; gap:8px; padding:10px 12px; border-bottom:1px solid rgba(255,255,255,.08);
      background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,0))}
    .title{display:flex; align-items:center; gap:8px}
    .dot{width:10px; height:10px; border-radius:50%; box-shadow:0 0 0 2px rgba(0,0,0,.25) inset}
    .ok{background:var(--ok)} .warn{background:var(--warn)} .err{background:var(--err)} .lock{background:#8b93a6}
    .card header h3{margin:0; font-size:14px; letter-spacing:.3px}
    .act{display:flex; gap:8px}
    .iconbtn{appearance:none; border:1px solid rgba(255,255,255,.18); background:rgba(255,255,255,.06); color:var(--txt);
      padding:6px 10px; border-radius:10px; font-size:12px; display:inline-flex; align-items:center; gap:6px; cursor:pointer; backdrop-filter:var(--blur); -webkit-backdrop-filter:var(--blur);
      transition:transform .15s var(--ease), background .2s var(--ease)}
    .iconbtn:active{ transform:scale(.98) }
    .iconbtn svg{width:16px; height:16px; stroke:currentColor; fill:none}
    .content{position:absolute; inset:48px 12px 12px 12px; overflow:auto; border-radius:12px}
    .mod-section{display:grid; gap:12px; background:rgba(5,8,14,.6); border:1px solid rgba(255,255,255,.08); border-radius:12px; padding:12px; animation: rise .35s var(--ease) both}
    .row{display:grid; gap:8px}
    label{font-size:12px; color:var(--muted)}
    input,textarea,select{width:100%; padding:10px 12px; border-radius:10px; border:1px solid rgba(255,255,255,.16); background:rgba(255,255,255,.05); color:var(--txt); outline:none}
    @keyframes rise{from{transform:translateY(8px);opacity:0} to{transform:translateY(0);opacity:1}}

    /* =========== LOJA / ESTOJO (gaveta) =========== */
    #panelConfigCenter{ position:fixed; inset:auto 0 0 0; transform: translateY(100%); transition: transform .5s ease; z-index:20 }
    #panelConfigCenter[data-open="true"]{ transform: translateY(0) }
    .config-inner{ padding:16px; background: linear-gradient(180deg, rgba(12,18,30,.35), rgba(12,18,30,.75)); border-top:1px solid rgba(255,255,255,.14);
      backdrop-filter: blur(20px); border-top-left-radius:24px; border-top-right-radius:24px }
    .tabs{ display:flex; gap:8px; overflow:auto; padding-bottom:6px }
    .tab{ flex:0 0 auto; padding:.5rem .8rem; border:1px solid rgba(255,255,255,.14); border-radius:999px; font-weight:700; background:rgba(255,255,255,.03) }
    .tab[data-active="true"]{ background: linear-gradient(90deg, rgba(123,74,255,.35), rgba(10,212,255,.28)) }
    .grid-cards{ display:grid; grid-template-columns:1fr; gap:10px; margin-top:12px }
    .cardx{ border:1px solid rgba(255,255,255,.14); border-radius:16px; padding:12px; background:rgba(255,255,255,.02) }
    .cardx h3{ margin:0 0 6px; font-size:16px; }
    .cardx p{ margin:0 0 10px; color:var(--muted); font-size:13px; }
    .led{ width:10px; height:10px; border-radius:50%; display:inline-block; vertical-align:middle; margin-right:6px; box-shadow:0 0 12px currentColor }
    .led.ok{ color:var(--ok) } .led.off{ color:#4c5563 } .led.warn{ color:var(--warn) }

    /* =========== util ========= */
    .hide{display:none}
    .btn{appearance:none; border:var(--line); background:rgba(255,255,255,.04); color:var(--txt); padding:8px 12px; border-radius:10px; cursor:pointer; font-weight:700 }
    .btn.ghost{background:transparent; border-style:dashed}
    .pill{padding:6px 10px; border-radius:999px; border:1px solid rgba(255,255,255,.14); background:rgba(255,255,255,.06); font-size:12px; color:var(--muted); display:inline-flex; gap:8px; align-items:center }
    .mut{color:var(--muted)}
    .kbd{font:600 .78rem/1 ui-monospace,monospace; background:rgba(255,255,255,.06); border:var(--line); padding:2px 6px; border-radius:8px}
  </style>
</head>
<body>
  <!-- Mini indicador de cena -->
  <div class="scene-indicator" id="sceneIndicator" aria-live="polite">
    <span class="label" id="sceneLabel">Cena: Espaço</span>
    <button class="reset" id="sceneReset" title="Reset cena">Reset</button>
  </div>

  <!-- Stage / Orbe -->
  <div class="stage">
    <div class="orb-scene" id="scene" role="application" aria-label="Campo Nebula">
      <div class="orb-wrap" id="orbWrap" aria-label="Orbe Nebula" tabindex="0">
        <div class="orb" aria-hidden="true"></div>
        <div class="orb-glow" aria-hidden="true"></div>
        <div class="orbe-label">KOBLLUX</div>
        <div class="options" id="hudOptions">
          <button class="opt fenda" data-open="fenda" aria-label="Abrir Fenda">
            <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M12 2l8 4-8 4-8-4 8-4Z"/><path d="M4 6v8l8 4 8-4V6"/><path d="M12 10v8"/></svg><div class="lab">Fenda</div>
          </button>
          <button class="opt sigilo" data-open="sigilo" aria-label="Abrir Sigilo">
            <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M12 3v18"/><path d="M5 9h14"/><path d="M7 15h10"/><path d="M6 6l3 3-3 3"/><path d="M18 6l-3 3 3 3"/></svg><div class="lab">Sigilo</div>
          </button>
          <button class="opt chaves" data-open="chaves" aria-label="Abrir Chaves">
            <svg viewBox="0 0 24 24" aria-hidden="true"><circle cx="7" cy="7" r="3"/><path d="M9 9l8 8"/><path d="M14 14l3 3l2-2l-3-3"/></svg><div class="lab">Chaves</div>
          </button>
          <button class="opt playlist" data-open="player" aria-label="Abrir Player">
            <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M4 6h12"/><path d="M4 10h12"/><path d="M4 14h8"/><circle cx="18" cy="16" r="3"/></svg><div class="lab">Playlist</div>
          </button>
        </div>
      </div>
      <div class="call" id="call">Toque o orbe para ativar · Sempre único, sempre seu.</div>
    </div>
  </div>

  <!-- Backdrop + Card (módulos) -->
  <div class="backdrop" id="backdrop"></div>
  <section class="card" id="card">
    <header>
      <div class="title"><div class="dot ok"></div><h3 id="cardTitle">Módulo</h3></div>
      <div class="act">
        <button class="iconbtn" data-min="true" title="Minimizar">▾</button>
        <button class="iconbtn" data-close title="Fechar">✕</button>
      </div>
    </header>
    <div class="content" id="cardContent"></div>
  </section>

  <!-- ESTOJO (Loja / Config Center) -->
  <aside id="panelConfigCenter" aria-label="Estojo de Módulos" data-open="false">
    <div class="config-inner">
      <div class="tabs" role="tablist">
        <button class="tab" data-tab="Ferramentas" data-active="true">Ferramentas</button>
        <button class="tab" data-tab="Mídia">Mídia</button>
        <button class="tab" data-tab="Chaves">Chaves</button>
        <button class="tab" data-tab="Símbolos">Símbolos</button>
        <button class="tab" data-tab="Layouts">Layouts</button>
      </div>
      <div class="grid-cards" id="cards"></div>
      <div style="text-align:center; margin-top:10px"><button id="closeConfig" class="btn ghost">Fechar Estojo</button></div>
    </div>
  </aside>

  <script>
  /* ================== BRAIN / ESTADO (Baú = LocalStorage) ==================== */
  const Brain = (() => {
    const LS = { CONFIG:'dual.config', LAST_HTML:'dual.lastHTML', USER_SYMBOL:'dual.user.symbol', ONBOARD_OK:'dual.onboard.ok', KEYS:'dual.keys' };
    const defaultConfig = { assets:[], modules:{ core_storage:true, sys_logs:true, net_ping:true, sec_keys:true, dev_html:true, player:true, sigil:true }, theme:'nebula', fusion:{A:'Atlas',B:'Nova'} };
    let config=null; const registry={};
    const Logs = (()=>{ const box=()=>document.getElementById('logs')||{prepend(){}}; return { add(msg){ const el=document.createElement('div'); const t=new Date().toLocaleTimeString(); el.textContent='['+t+'] '+msg; box().prepend(el); }, clear(){ const el=document.getElementById('logs'); if(el) el.innerHTML=''; } }; })();
    const saveJSON=(k,o)=>{ try{ localStorage.setItem(k, JSON.stringify(o)); }catch(e){ Logs.add('saveJSON fail '+e); } };
    const loadJSON=(k,f=null)=>{ try{ const r=localStorage.getItem(k); return r?JSON.parse(r):f; }catch(e){ Logs.add('loadJSON fail '+e); return f; } };
    function ensureConfig(){ config=loadJSON(LS.CONFIG,null); if(!config){ config=structuredClone(defaultConfig); saveJSON(LS.CONFIG,config);} return config; }
    function setModuleFlag(name,v){ config.modules[name]=!!v; saveJSON(LS.CONFIG,config); }
    function mount(name){ const def = registry[name]; if(def && def.mount) def.mount(); }
    function unmount(name){ const def = registry[name]; if(def && def.unmount) def.unmount(); }
    return { LS, ensureConfig, get config(){ return config??ensureConfig(); }, setModuleFlag, registry, mount, unmount, Logs, saveJSON, loadJSON };
  })();

  /* ================== MODULARIZAÇÃO ==================== */
  function registerModule(def){ Brain.registry[def.name]=def; }

  // —— Baú (status + import/export) ——
  registerModule({ name:'core_storage', title:'Baú • LocalStorage', group:'Ferramentas',
    ui(){ return `
      <div class="mod-section">
        <div class="row"><strong>Status</strong>
          <div id="storageInfo">
            <div class="kv"><span>dual.config</span> <span id="kvConfig" class="pill">–</span></div>
            <div class="kv"><span>dual.onboard.ok</span> <span id="kvOnboard" class="pill">–</span></div>
            <div class="kv"><span>dual.lastHTML</span> <span id="kvHTML" class="pill">–</span></div>
          </div>
        </div>
        <div class="row">
          <div class="title" style="display:flex;gap:8px;align-items:center"><div class="dot ok"></div><strong>Backup</strong></div>
          <div style="display:flex; gap:8px; flex-wrap:wrap">
            <button class="btn" id="btnExport">Exportar</button>
            <label class="btn">Importar<input id="fileImport" type="file" accept="application/json" class="hide"/></label>
          </div>
        </div>
      </div>`; },
    mount(){ const cfg=Brain.config; document.getElementById('kvConfig').textContent = Object.keys(cfg.modules).filter(k=>cfg.modules[k]).length+' módulos on';
      document.getElementById('kvOnboard').textContent = localStorage.getItem(Brain.LS.ONBOARD_OK)==='1'?'sim':'não';
      document.getElementById('kvHTML').textContent = localStorage.getItem(Brain.LS.LAST_HTML)?'salvo':'—';
      // handlers
      const exp=document.getElementById('btnExport'); if(exp) exp.onclick=()=>{
        const data={ config:Brain.config, keys:Brain.loadJSON(Brain.LS.KEYS,{}), html:localStorage.getItem(Brain.LS.LAST_HTML)||null, symbol:Brain.loadJSON(Brain.LS.USER_SYMBOL,null) };
        const blob=new Blob([JSON.stringify(data,null,2)],{type:'application/json'}); const url=URL.createObjectURL(blob);
        const a=document.createElement('a'); a.href=url; a.download='dual_backup.json'; a.click(); URL.revokeObjectURL(url);
      };
      const imp=document.getElementById('fileImport'); if(imp) imp.onchange=(e)=>{ const f=e.target.files&&e.target.files[0]; if(!f) return; const r=new FileReader(); r.onload=()=>{ try{
        const data=JSON.parse(r.result); if(data.config) Brain.saveJSON(Brain.LS.CONFIG,data.config); if(data.keys) Brain.saveJSON(Brain.LS.KEYS,data.keys); if(data.html) localStorage.setItem(Brain.LS.LAST_HTML,data.html); if(data.symbol) Brain.saveJSON(Brain.LS.USER_SYMBOL,data.symbol); alert('Importado!'); }catch(err){ alert('Falha ao importar'); }}; r.readAsText(f); };
    },
    unmount(){/* noop */}
  });

  // —— Logs ——
  registerModule({ name:'sys_logs', title:'Logs', group:'Ferramentas',
    ui(){ return `<div class="mod-section"><div class="row"><div id="logs" style="font-family:ui-monospace, Menlo, Consolas; font-size:12px; line-height:1.5; max-height:30svh; overflow:auto"></div><button class="btn" id="btnClearLogs">Limpar</button></div></div>`; },
    mount(){ const b=document.getElementById('btnClearLogs'); if(b) b.onclick=()=>Brain.Logs.clear(); }, unmount(){}
  });

  // —— Ping simples ——
  registerModule({ name:'net_ping', title:'Rede & Ping', group:'Ferramentas',
    ui(){ return `
      <div class="mod-section">
        <div class="row"><label>Endpoint</label><input id="pingUrl" value="https://dns.google/resolve?name=google.com"/></div>
        <div class="row" style="display:flex;gap:8px;flex-wrap:wrap"><button class="btn" id="btnPing">Ping</button><span class="pill">último: <b id="pingVal">–</b> ms</span><span class="pill">mín: <b id="pingMin">–</b></span><span class="pill">máx: <b id="pingMax">–</b></span></div>
      </div>`; },
    mount(){ let min=Infinity, max=0; const val=(n)=>{document.getElementById('pingVal').textContent=n;};
      const set=()=>{document.getElementById('pingMin').textContent=min===Infinity?'–':min; document.getElementById('pingMax').textContent=max||'–'};
      const go=async()=>{ const url=document.getElementById('pingUrl').value; const t=performance.now(); try{ await fetch(url,{cache:'no-store'}) }catch{} const d=Math.round(performance.now()-t); min=Math.min(min,d); max=Math.max(max,d); val(d); set(); Brain.Logs.add('Ping '+d+'ms'); };
      const b=document.getElementById('btnPing'); if(b) b.onclick=go; },
    unmount(){/* noop */}
  });

  // —— Chaves SK (CRUD + ativa) ——
  registerModule({ name:'sec_keys', title:'Chaves SK', group:'Chaves',
    ui(){ return `
      <div class="mod-section">
        <div class="row" style="display:flex;gap:8px;flex-wrap:wrap">
          <input id="inKeyLabel" placeholder="apelido" style="flex:1"/>
          <input id="inKeyValue" placeholder="sk-..." style="flex:2"/>
          <button class="btn" id="btnAddKey">Adicionar</button>
        </div>
        <div id="keysList"></div>
      </div>`; },
    mount(){ const add=()=>{ const k=Brain.loadJSON(Brain.LS.KEYS,{}); const label=document.getElementById('inKeyLabel').value.trim()||('key-'+Date.now()); const val=document.getElementById('inKeyValue').value.trim(); if(!val){alert('Informe a chave'); return;} k[label]=val; Brain.saveJSON(Brain.LS.KEYS,k); render(); };
      const render=()=>{ const box=document.getElementById('keysList'); const k=Brain.loadJSON(Brain.LS.KEYS,{}); box.innerHTML=''; Object.keys(k).forEach(label=>{ const row=document.createElement('div'); row.className='pill'; row.style.display='flex'; row.style.justifyContent='space-between'; row.style.gap='8px'; row.style.alignItems='center'; row.innerHTML=`<span class="mono" style="font-family:ui-monospace">${label}</span><div style="display:flex;gap:6px"><button class="btn ghost" data-copy="${label}">Copiar</button><button class="btn ghost" data-del="${label}">Remover</button></div>`; box.appendChild(row); }); box.onclick=(e)=>{ const btn=e.target.closest('button'); if(!btn) return; const label=btn.getAttribute('data-copy')||btn.getAttribute('data-del'); if(btn.hasAttribute('data-copy')){ navigator.clipboard.writeText(k[label]||''); alert('Copiado'); } else { delete k[label]; Brain.saveJSON(Brain.LS.KEYS,k); render(); } }; };
      const b=document.getElementById('btnAddKey'); if(b) b.onclick=add; render(); },
    unmount(){/* noop */}
  });

  // —— HTML Viewer (upload/preview) ——
  registerModule({ name:'dev_html', title:'HTML Viewer', group:'Ferramentas',
    ui(){ return `
      <div class="mod-section">
        <div class="row" id="htmlDrop" style="text-align:center">
          <div style="font-weight:800; margin-bottom:6px">Solte um arquivo <span class="kbd">.html</span> ou clique para escolher</div>
          <div class="mut">Dica: <span class="kbd">Arraste & Solte</span> / <span class="kbd">Ctrl+O</span> / <span class="kbd">⌘+O</span></div>
          <input id="inpHtmlFile" type="file" accept=".html,text/html" class="hide" />
        </div>
        <iframe id="htmlFrame" title="Documento HTML" sandbox="allow-same-origin allow-forms allow-scripts" style="width:100%; height:52dvh; border:var(--line); border-radius:12px; background:#000"></iframe>
      </div>`; },
    mount(){ const drop=document.getElementById('htmlDrop'); const inp=document.getElementById('inpHtmlFile'); const frame=document.getElementById('htmlFrame');
      const open=(file)=>{ const r=new FileReader(); r.onload=()=>{ localStorage.setItem(Brain.LS.LAST_HTML,r.result); frame.srcdoc=r.result; Brain.Logs.add('HTML carregado'); }; r.readAsText(file); };
      drop.onclick=()=>inp.click(); inp.onchange=(e)=>{ const f=e.target.files&&e.target.files[0]; if(f) open(f); };
      drop.ondragover=(e)=>{ e.preventDefault(); drop.style.outline='2px dashed rgba(255,255,255,.4)'; };
      drop.ondragleave=()=>{ drop.style.outline='none'; };
      drop.ondrop=(e)=>{ e.preventDefault(); drop.style.outline='none'; const f=e.dataTransfer.files&&e.dataTransfer.files[0]; if(f) open(f); };
      const saved=localStorage.getItem(Brain.LS.LAST_HTML); if(saved) frame.srcdoc=saved; },
    unmount(){/* noop */}
  });

  // —— Player (placeholder) ——
  registerModule({ name:'player', title:'Playlist', group:'Mídia', ui(){ return `<div class="mod-section"><div class="row"><p class="mut">Suba suas faixas (futuro).</p></div></div>`; }, mount(){}, unmount(){} });

  // —— Sigilo (placeholder leve) ——
  registerModule({ name:'sigil', title:'Símbolos & Sigilos', group:'Símbolos', ui(){ return `<div class="mod-section"><div class="row"><p class="mut">Gerador SVG (futuro). Por ora, use seu avatar.</p></div></div>`; }, mount(){}, unmount(){} });

  /* ================== UI FLOW / ROUTER ==================== */
  const orbWrap = document.getElementById('orbWrap');
  const hud     = document.getElementById('hudOptions');
  const call    = document.getElementById('call');
  const card    = document.getElementById('card');
  const cardC   = document.getElementById('cardContent');
  const cardT   = document.getElementById('cardTitle');
  const backdrop= document.getElementById('backdrop');
  const sceneInd= document.getElementById('sceneIndicator');
  const sceneLab= document.getElementById('sceneLabel');

  function openModule(name){ const def=Brain.registry[name]; if(!def){ alert('módulo não encontrado: '+name); return; } cardC.innerHTML = def.ui? def.ui() : '<div class="mod-section"><p>Sem UI</p></div>'; card.classList.add('active'); backdrop.classList.add('active'); cardT.textContent = def.title||name; Brain.mount(name); }
  function closeCard(){ card.classList.remove('active'); backdrop.classList.remove('active'); }

  // Primeira ativação → mostra HUD + abre Estojo
  orbWrap.addEventListener('click', ()=>{
    hud.classList.add('active'); if (call) call.textContent = 'Ativado · HUD + Estojo'; sceneLab.textContent='Espaço Ativo'; sceneInd.classList.add('show');
    // Marca onboarding
    localStorage.setItem(Brain.LS.ONBOARD_OK,'1');
    // Abre Estojo suavemente na primeira vez
    setTimeout(()=>document.getElementById('panelConfigCenter').setAttribute('data-open','true'), 200);
  }, { once:true });

  // Abrir via HUD
  document.addEventListener('click', (ev)=>{
    const t = ev.target.closest && ev.target.closest('.opt[data-open]'); if(!t) return; const id=t.getAttribute('data-open');
    const map={ fenda:'dev_html', sigilo:'sigil', chaves:'sec_keys', player:'player' };
    openModule(map[id]||id);
  }, true);

  // Minimizar/fechar card
  card.addEventListener('click', (e)=>{
    if(e.target.matches('[data-close]')) closeCard();
    if(e.target.matches('[data-min]')) card.classList.toggle('min');
  });
  backdrop.addEventListener('click', ()=>closeCard());

  // Estojo / Loja de módulos
  function renderEstojo(){
    const grid=document.getElementById('cards'); if(!grid) return; grid.innerHTML=''; const groups=['Ferramentas','Mídia','Chaves','Símbolos','Layouts'];
    const defs=Object.values(Brain.registry);
    groups.forEach(g=>{
      defs.filter(d=>d.group===g).forEach((d,i)=>{
        const el=document.createElement('div'); el.className='cardx'; el.innerHTML=`<h3>${d.title||d.name}</h3><p class="mut">Grupo: ${d.group}</p><div style="display:flex;gap:8px;flex-wrap:wrap"><button class="btn" data-open="${d.name}">Abrir</button><button class="btn ghost" data-toggle="${d.name}">Ativar/Desativar</button></div>`; grid.appendChild(el);
      });
    });
    grid.onclick=(e)=>{ const btn=e.target.closest('button'); if(!btn) return; const open=btn.getAttribute('data-open'); const tog=btn.getAttribute('data-toggle'); if(open){ openModule(open); } if(tog){ const cur=!!Brain.config.modules[tog]; Brain.setModuleFlag(tog,!cur); alert(`${tog}: ${!cur?'ativo':'inativo'}`); } };
  }

  document.getElementById('closeConfig').onclick=()=>document.getElementById('panelConfigCenter').setAttribute('data-open','false');

  // Reset cena (limpa onboarding e HUD)
  document.getElementById('sceneReset').onclick=()=>{
    localStorage.removeItem(Brain.LS.ONBOARD_OK); hud.classList.remove('active'); document.getElementById('panelConfigCenter').setAttribute('data-open','false'); call.textContent='Toque o orbe para ativar · Sempre único, sempre seu.'; sceneInd.classList.remove('show');
  };

  // Boot
  (function boot(){ Brain.ensureConfig(); renderEstojo(); })();

  </script>
</body>
</html>
