<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"/>
  <title>Dual.Infodose — Clean Mobile (Config • Paletas • Menus)</title>
  <meta name="theme-color" content="#0b0b0f"/>
  <style>
    :root{
      --ink:#eef2ff; --muted:#aeb7d6; --border:rgba(255,255,255,.16);
      --panel:rgba(0,0,0,.45); --radius:18px; --safe: env(safe-area-inset-bottom, 16px);
      --glow:0 0 28px rgba(255,255,255,.14), 0 0 64px rgba(255,255,255,.10);
      --grad: linear-gradient(42deg,#f0f,#0ff);
    }
    *{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
    html,body{height:100%}
    body{
      margin:0; color:var(--ink);
      background:
        radial-gradient(1200px 700px at 50% -20%, rgba(255,255,255,.06), transparent 60%),
        radial-gradient(900px 900px at 50% 120%, rgba(255,255,255,.05), transparent 60%),
        var(--grad);
      background-attachment: fixed;
      font: 400 16px/1.38 ui-rounded, system-ui, -apple-system, Inter, Segoe UI, Roboto, Arial;
      display:flex; flex-direction:column;
      transition: background .4s ease;
    }
    header{position:sticky; top:0; z-index:5; display:flex; justify-content:space-between; align-items:center;
      padding:14px 16px calc(10px + var(--safe)) 16px; background:linear-gradient(to bottom, rgba(0,0,0,.55), rgba(0,0,0,.25) 70%, transparent);
      backdrop-filter: blur(14px); border-bottom:1px solid var(--border)}
    .brand{display:flex; gap:10px; align-items:center}
    .pill{width:90px;height:40px;border-radius:24px;overflow:hidden;display:grid;place-items:center;background:#07070a;box-shadow:inset 0 0 0 1px rgba(255,255,255,.10), var(--glow)}
    .menuBtn{width:44px;height:44px;border-radius:14px;background:rgba(255,255,255,.08);display:grid;place-items:center;border:1px solid var(--border);box-shadow:var(--glow)}
    main{flex:1; display:flex; flex-direction:column; padding:12px 14px 0 14px; gap:12px; max-width:720px; margin:0 auto;}
    .card{background:var(--panel); border:1px solid var(--border); border-radius:var(--radius); padding:12px; box-shadow:var(--glow); backdrop-filter: blur(8px)}
    .center{display:grid; place-items:center}
    .symbolPad{width:min(86vw, 480px); aspect-ratio: 2.2 / 1; position:relative; display:grid; place-items:center; border-radius:30px; background:#07070a; overflow:hidden; box-shadow:inset 0 0 0 2px rgba(255,255,255,.12), var(--glow)}
    .symbolPad .ring{position:absolute; inset:0; border-radius:30px; box-shadow:inset 0 0 0 2px rgba(255,255,255,.10)}
    .symbolPad .ring.r2{inset:8px; animation:pulse 3.4s ease-in-out infinite}
    .symbolPad .ring.r3{inset:16px; animation:pulse 3.4s ease-in-out .9s infinite}
    @keyframes pulse{0%,100%{box-shadow:inset 0 0 0 2px rgba(255,255,255,.10)}50%{box-shadow:inset 0 0 0 2px rgba(255,255,255,.26)}}
    /* chat */
    #chat{display:flex; flex-direction:column; gap:8px; height:56vh}
    .log{flex:1; overflow:auto; padding:10px 6px; display:flex; flex-direction:column; gap:8px; scroll-behavior:smooth}
    .msg{max-width:86%; padding:10px 12px; border-radius:14px; border:1px solid var(--border); box-shadow:var(--glow); white-space:pre-wrap}
    .you{align-self:flex-end; background:rgba(255,255,255,.10)}
    .ai{align-self:flex-start; background:rgba(0,0,0,.25)}
    .bar{display:flex; gap:8px; align-items:center}
    input, textarea, select{background:#0b0b12; color:var(--ink); border:1px solid var(--border); border-radius:12px; padding:12px 12px; width:100%}
    button{background:#0e0e16; color:var(--ink); border:1px solid rgba(255,255,255,.22); border-radius:12px; padding:12px 16px; font-weight:700}
    small{color:var(--muted)}
    .toggles{display:flex; gap:8px; align-items:center}
    .toggleBtn{display:inline-flex; align-items:center; gap:8px; padding:10px 12px; border-radius:14px; border:1px solid var(--border); background:rgba(255,255,255,.08); box-shadow:var(--glow); font-weight:700}
    .toggleBtn .dot{width:10px;height:10px;border-radius:50%;background:#aaa}
    .toggleBtn.on{background:rgba(255,255,255,.16)}
    .toggleBtn.on .dot{background:#5ef3ff; box-shadow:0 0 12px #5ef3ffaa}
    /* bottom sheet menu */
    .sheet{position:fixed; left:0; right:0; bottom:0; z-index:20; translate:0 110%;
      background:linear-gradient(to top, rgba(0,0,0,.88), rgba(0,0,0,.76));
      border-top:1px solid var(--border); border-top-left-radius:18px; border-top-right-radius:18px;
      padding:12px 12px calc(12px + var(--safe)); backdrop-filter: blur(16px);
      transition:translate .28s ease;
    }
    .sheet.open{translate:0 0}
    .tabs{display:flex; gap:8px; margin-bottom:8px}
    .tab{flex:1; text-align:center; padding:10px 12px; border-radius:12px; border:1px solid var(--border); background:rgba(255,255,255,.08); font-weight:800}
    .tab.active{background:rgba(255,255,255,.16)}
    .panel{display:none}
    .panel.show{display:block}
    .row{display:flex; gap:8px; align-items:center; flex-wrap:wrap}
    .progress{height:10px; border-radius:8px; background:rgba(255,255,255,.12); overflow:hidden}
    .progress > div{height:100%; width:0%; background:linear-gradient(90deg,#8af,#0ff)}
  </style>
</head>
<body>
  <header>
    <div class="brand">
      <div class="pill">
        <svg viewBox="0 0 120 40" width="76" height="26" aria-hidden="true">
          <path d="M10 24c12-12 22-12 34 0s22 12 34 0" stroke="white" stroke-width="4" fill="none"/>
          <path d="M10 28c12-12 22-12 34 0s22 12 34 0" stroke="white" stroke-width="3" opacity=".9" fill="none"/>
          <circle cx="45" cy="21" r="2.4" fill="white"/>
          <path d="M89 19l6 3-6 3z" fill="white"/>
        </svg>
      </div>
      <div>
        <div style="font-weight:900; letter-spacing:.4px">Dual.Infodose</div>
        <small>Clean • Config + Paletas no Menu</small>
      </div>
    </div>
    <button class="menuBtn" id="menuBtn">☰</button>
  </header>

  <main>
    <section class="center">
      <div class="symbolPad" id="pad">
        <div class="ring"></div><div class="ring r2"></div><div class="ring r3"></div>
        <svg id="face" class="mood" viewBox="0 0 120 120" width="92" height="92">
          <circle cx="60" cy="60" r="44" stroke="white" stroke-width="8" fill="none" opacity=".9"/>
          <g id="eyes">
            <ellipse id="eyeL" cx="46" cy="56" rx="13" ry="10" fill="white" opacity=".95"/>
            <ellipse id="eyeR" cx="74" cy="56" rx="13" ry="10" fill="white" opacity=".95"/>
            <circle id="pupilL" cx="46" cy="56" r="4" fill="#090a10"/>
            <circle id="pupilR" cx="74" cy="56" r="4" fill="#090a10"/>
          </g>
          <path id="mouth" d="M45 84q15 10 30 0" stroke="white" stroke-width="6" fill="none" stroke-linecap="round"/>
        </svg>
      </div>
    </section>

    <section id="chat" class="card">
      <div class="row" style="justify-content:space-between">
        <strong>Conversas</strong>
        <div class="toggles">
          <button id="btnTTS" class="toggleBtn" aria-pressed="false"><span class="dot"></span>🔊 TTS</button>
          <button id="btnSave" class="toggleBtn on" aria-pressed="true"><span class="dot"></span>💾 Salvar</button>
        </div>
      </div>
      <div class="log" id="log" aria-live="polite"></div>
      <div class="bar">
        <input id="prompt" type="text" placeholder="Toque e fale com a AA…"/>
        <button id="send">Enviar</button>
      </div>
      <small>Dica: Config/Modelos/ASCII/Downloads agora no botão ☰ do topo.</small>
    </section>
    <div style="height:max(20px,var(--safe))"></div>
  </main>

  <!-- Bottom Sheet Menu -->
  <div class="sheet" id="sheet">
    <div class="tabs">
      <button class="tab active" data-tab="cfg">Config</button>
      <button class="tab" data-tab="arc">Arquétipos</button>
      <button class="tab" data-tab="dl">Downloads</button>
      <button class="tab" data-tab="asc">ASCII Studio</button>
    </div>

    <!-- Config Panel -->
    <div class="panel show" id="panel-cfg">
      <div class="card" style="padding:10px">
        <label style="font-weight:800">OpenRouter API Key</label>
        <input id="apiKey" type="password" placeholder="sk-or-v1-..."/>
        <div style="height:8px"></div>
        <label style="font-weight:800">Modelo</label>
        <select id="model">
          <option value="openrouter/auto">openrouter/auto (auto)</option>
          <option value="mistralai/mistral-nemo">mistralai/mistral-nemo (grátis*)</option>
          <option value="google/gemma-2-9b-it">google/gemma-2-9b-it (grátis*)</option>
          <option value="nousresearch/hermes-3-llama-3.1-405b">nousresearch/hermes-3-llama-3.1-405b</option>
          <option value="perplexity/llama-3.1-sonar-small-chat">perplexity/llama-3.1-sonar-small-chat</option>
          <option value="anthropic/claude-3.5-sonnet">anthropic/claude-3.5-sonnet</option>
        </select>
        <small class="muted">*disponibilidade pode variar conforme a cota da OpenRouter.</small>
        <div style="height:8px"></div>
        <label style="font-weight:800">System prompt</label>
        <textarea id="system" placeholder="Você é a AA Dual.Infodose…">Você é a AA Dual.Infodose. Responda curto, útil, amigável, em pt-BR, com foco mobile.</textarea>
        <div style="height:8px"></div>
        <div class="row">
          <button id="saveCfg">Salvar</button>
          <button id="testCfg">Testar ping</button>
        </div>
      </div>
    </div>

    <!-- Archetypes Panel -->
    <div class="panel" id="panel-arc">
      <div class="card" style="padding:10px">
        <label style="font-weight:800">Paleta por Arquétipo</label>
        <div class="row">
          <button class="chip" data-arc="atlas">Atlas</button>
          <button class="chip" data-arc="nova">Nova</button>
          <button class="chip" data-arc="vitalis">Vitalis</button>
          <button class="chip" data-arc="pulse">Pulse</button>
          <button class="chip" data-arc="artemis">Artemis</button>
          <button class="chip" data-arc="serena">Serena</button>
          <button class="chip" data-arc="kaos">Kaos</button>
          <button class="chip" data-arc="genus">Genus</button>
          <button class="chip" data-arc="lumine">Lumine</button>
          <button class="chip" data-arc="aion">Aion</button>
          <button class="chip" data-arc="rhea">Rhea</button>
          <button class="chip" data-arc="horus">Horus</button>
        </div>
      </div>
    </div>

    <!-- Downloads Panel -->
    <div class="panel" id="panel-dl">
      <div class="card" style="padding:10px">
        <label style="font-weight:800">Fila de downloads (uma URL por linha)</label>
        <textarea id="urls" placeholder="https://example.com/file1.mp3
https://example.com/file2.png"></textarea>
        <div class="row">
          <button id="dlQueue">Iniciar fila</button>
          <button id="dlClear">Limpar fila</button>
        </div>
        <div id="queue"></div>
      </div>
    </div>

    <!-- ASCII Studio Panel -->
    <div class="panel" id="panel-asc">
      <div class="card" style="padding:10px">
        <label style="font-weight:800">ASCII-DSL</label>
        <textarea id="asciiSrc" placeholder="@fps:8 dur:2200
( ͡° ͜ʖ ͡°)━☆ﾟ.*･｡ﾟ
CÉREBRO-ORÁCULO pulsando em:
criar animações custom
---
( ͡° ͜ʖ ͡°)  ☆ﾟ.*･｡ﾟ
CÉREBRO-ORÁCULO pulsando em:
criar animações custom"></textarea>
        <div class="row">
          <button id="runAnim">▶︎ Rodar</button>
          <button id="saveAnim">💾 Salvar</button>
          <button id="loadAnim">⤓ Carregar</button>
          <button id="clearAnim">🧹 Limpar</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    const $=(q)=>document.querySelector(q);
    const body=document.body;
    const logEl=$('#log'), promptEl=$('#prompt'), sendBtn=$('#send');
    const apiKeyEl=$('#apiKey'), modelEl=$('#model'), systemEl=$('#system');
    const menuBtn=$('#menuBtn'), sheet=$('#sheet');
    const tabs=[...document.querySelectorAll('.tab')];
    const panels={cfg:$('#panel-cfg'), arc:$('#panel-arc'), dl:$('#panel-dl'), asc:$('#panel-asc')};

    // storage
    const cfgKey='dual_cfg', histKey='dual_hist', animKey='dual_ascii_script';
    const store={ get cfg(){try{return JSON.parse(localStorage.getItem(cfgKey)||'{}')}catch(_){return{}}}, set cfg(v){localStorage.setItem(cfgKey, JSON.stringify(v))},
                  get hist(){try{return JSON.parse(localStorage.getItem(histKey)||'[]')}catch(_){return[]}}, set hist(v){localStorage.setItem(histKey, JSON.stringify(v))},
                  get anim(){return localStorage.getItem(animKey)||''}, set anim(v){localStorage.setItem(animKey, v)} }

    // UI helpers
    function openMenu(){ sheet.classList.add('open'); }
    function closeMenu(){ sheet.classList.remove('open'); }
    menuBtn.onclick=openMenu;
    sheet.addEventListener('click', e=>{ if(e.target===sheet) closeMenu(); });
    tabs.forEach(t=>t.onclick=()=>{
      tabs.forEach(x=>x.classList.remove('active')); t.classList.add('active');
      Object.values(panels).forEach(p=>p.classList.remove('show'));
      panels[t.dataset.tab].classList.add('show');
    });

    // toggles
    const btnTTS=$('#btnTTS'), btnSave=$('#btnSave');
    function setToggle(el,on){ el.classList.toggle('on', !!on); el.setAttribute('aria-pressed', on?'true':'false'); }
    function loadCfgUI(){
      const {apiKey='', model='openrouter/auto', system='Você é a AA Dual.Infodose. Responda curto, útil, amigável, em pt-BR, com foco mobile.', autoTTS=false, persist=true } = store.cfg;
      apiKeyEl.value=apiKey; modelEl.value=model; systemEl.value=system;
      setToggle(btnTTS, !!autoTTS); setToggle(btnSave, !!persist);
    }
    loadCfgUI();
    $('#saveCfg').onclick=()=>{ store.cfg={ apiKey:apiKeyEl.value.trim(), model:modelEl.value, system:systemEl.value, autoTTS:btnTTS.classList.contains('on'), persist:btnSave.classList.contains('on') }; alert('Config salva.'); };
    $('#testCfg').onclick=()=>{ alert('Pronto! Chave salva no menu Config. O chat usa isso na próxima mensagem.'); };

    btnTTS.onclick=()=> setToggle(btnTTS, !btnTTS.classList.contains('on'));
    btnSave.onclick=()=> setToggle(btnSave, !btnSave.classList.contains('on'));

    // palettes by archetype
    const palettes={
      atlas:'linear-gradient(42deg,#65d,#7ef)',
      nova:'linear-gradient(42deg,#ff7edb,#7ef)',
      vitalis:'linear-gradient(42deg,#aaff88,#33ffd9)',
      pulse:'linear-gradient(42deg,#ff3cac,#784ba0)',
      artemis:'linear-gradient(42deg,#ffd36f,#ff6f91)',
      serena:'linear-gradient(42deg,#90caf9,#e3f2fd)',
      kaos:'linear-gradient(42deg,#ff8a00,#e52e71)',
      genus:'linear-gradient(42deg,#6a85b6,#bac8e0)',
      lumine:'linear-gradient(42deg,#ffe29f,#ffa99f)',
      aion:'linear-gradient(42deg,#9796f0,#fbc7d4)',
      rhea:'linear-gradient(42deg,#43e97b,#38f9d7)',
      horus:'linear-gradient(42deg,#f0f,#0ff)'
    };
    document.querySelectorAll('[data-arc]').forEach(b=> b.onclick=()=>{ const key=b.dataset.arc; body.style.setProperty('--grad', palettes[key]||palettes.horus); });

    // ASCII Studio
    const asciiSrc=$('#asciiSrc'); const runAnim=$('#runAnim'), saveAnim=$('#saveAnim'), loadAnim=$('#loadAnim'), clearAnim=$('#clearAnim');
    const asciiOverlay = (()=>{
      const el=document.createElement('div'); el.style.cssText="position:fixed;left:10px;right:10px;top:64px;z-index:30;font-family:ui-monospace,monospace;color:#eaffff;white-space:pre;text-align:center;pointer-events:none;text-shadow:0 0 14px rgba(0,255,255,.4);opacity:0;transform:translateY(-8px);transition:opacity .18s ease, transform .18s ease;";
      document.body.appendChild(el); return el;
    })();
    let asciiTimer=null, asciiIndex=0;
    function showASCII(frames, duration=1600, fps=6){
      clearInterval(asciiTimer); asciiIndex=0; asciiOverlay.style.opacity='1'; asciiOverlay.style.transform='translateY(0)'; asciiOverlay.textContent=frames[0];
      const step=1000/Math.max(1,fps);
      asciiTimer=setInterval(()=>{ asciiIndex=(asciiIndex+1)%frames.length; asciiOverlay.textContent=frames[asciiIndex]; }, step);
      setTimeout(()=>{ asciiOverlay.style.opacity='0'; asciiOverlay.style.transform='translateY(-8px)'; clearInterval(asciiTimer); }, duration);
    }
    function showASCIIAnim(script){
      script=script.trim();
      let fps=6, dur=1600;
      const header=script.match(/^@([^\n]+)\n/);
      if(header){ const h=header[1]; script=script.slice(header[0].length); const fpsM=h.match(/fps:(\d+)/i); const durM=h.match(/dur:(\d+)/i); if(fpsM) fps=+fpsM[1]; if(durM) dur=+durM[1]; }
      const frames=script.split(/\n---\n/);
      showASCII(frames, dur, fps);
    }
    runAnim.onclick=()=> showASCIIAnim(asciiSrc.value||'');
    saveAnim.onclick=()=>{ store.anim=asciiSrc.value||''; alert('ASCII salvo.'); };
    loadAnim.onclick=()=>{ asciiSrc.value = store.anim || asciiSrc.placeholder; };
    clearAnim.onclick=()=>{ asciiSrc.value=''; };

    // Chat + OpenRouter (stream compacto)
    function addMsg(role, content){ let el=document.createElement('div'); el.className='msg '+(role==='user'?'you':'ai'); el.textContent=content; logEl.appendChild(el); logEl.scrollTop=logEl.scrollHeight; return el; }
    function pushHist(role, content){ if(btnSave.classList.contains('on')){ const h=store.hist; h.push({role, content}); store.hist=h.slice(-64);} }
    async function callStream(messages){
      const {apiKey, model='openrouter/auto'}=store.cfg; if(!apiKey){ alert('Abra ☰ → Config e cole sua OpenRouter API Key.'); return null; }
      try{
        const res=await fetch('https://openrouter.ai/api/v1/chat/completions', {method:'POST', headers:{'Content-Type':'application/json','Authorization':'Bearer '+apiKey,'HTTP-Referer':location.href,'X-Title':'Dual Clean'}, body: JSON.stringify({model, messages, temperature:0.7, stream:true})});
        if(!res.ok) throw new Error('HTTP '+res.status);
        return res.body;
      }catch(e){ alert('Falha na API: '+e.message); return null; }
    }
    let talkTimer=null; function startTalking(){ clearInterval(talkTimer); talkTimer=setInterval(()=>{ mouth.setAttribute('d', Math.random()<.5 ? "M52 86q8 -6 16 0" : "M45 84q15 10 30 0"); }, 90);} function stopTalking(){ clearInterval(talkTimer); mouth.setAttribute('d',"M45 84q15 10 30 0"); }
    async function send(){
      const q=promptEl.value.trim(); if(!q) return;
      promptEl.value=''; addMsg('user', q); pushHist('user', q);
      const messages=[{role:'system', content: store.cfg.system || 'Você é a AA Dual.Infodose. Curta e útil.'}, {role:'user', content:q}];
      sendBtn.disabled=true; sendBtn.textContent='…';
      const stream=await callStream(messages); if(!stream){ sendBtn.disabled=false; sendBtn.textContent='Enviar'; return; }
      startTalking();
      const out=addMsg('assistant',''); const reader=stream.getReader(); const dec=new TextDecoder(); let buf='';
      while(true){ const {value, done}=await reader.read(); if(done) break; buf+=dec.decode(value,{stream:true}); const parts=buf.split("\n\n"); for(let i=0;i<parts.length-1;i++){ const ch=parts[i]; if(ch.startsWith("data: ")){ const s=ch.slice(6); if(s==="[DONE]") continue; try{ const d=JSON.parse(s); const t=d.choices?.[0]?.delta?.content||""; if(t){ out.textContent+=t; logEl.scrollTop=logEl.scrollHeight; } }catch(_){} } } buf=parts[parts.length-1]; }
      stopTalking(); sendBtn.disabled=false; sendBtn.textContent='Enviar'; pushHist('assistant', out.textContent);
    }
    sendBtn.onclick=send; promptEl.addEventListener('keydown', e=>{ if(e.key==='Enter'){ e.preventDefault(); send(); }});

    // Downloads (fila interna no painel)
    const urlsEl=$('#urls'), dlQueueBtn=$('#dlQueue'), dlClearBtn=$('#dlClear'), queue=$('#queue');
    function mkRow(name){ const row=document.createElement('div'); row.className='row'; row.innerHTML=`<small style="flex:1">${name}</small><div class="progress" style="flex:2"><div></div></div>`; return row; }
    let orbitTimer=null, theta=0, orbitSide=1;
    function startOrbit(side=1){ clearInterval(orbitTimer); theta=0; orbitTimer=setInterval(()=>{ theta+=0.18; const r=3.5; const dx=r*Math.cos(theta)*side, dy=r*Math.sin(theta); $('#pupilL').setAttribute('cx',46+dx); $('#pupilL').setAttribute('cy',56+dy); $('#pupilR').setAttribute('cx',74-dx); $('#pupilR').setAttribute('cy',56-dy); }, 16); }
    function stopOrbit(){ clearInterval(orbitTimer); $('#pupilL').setAttribute('cx',46); $('#pupilL').setAttribute('cy',56); $('#pupilR').setAttribute('cx',74); $('#pupilR').setAttribute('cy',56); }
    async function downloadOne(url, side){
      const row=mkRow(url); const bar=row.querySelector('.progress > div'); queue.appendChild(row);
      try{
        startOrbit(side);
        const res=await fetch(url); if(!res.ok) throw new Error('HTTP '+res.status);
        const reader=res.body.getReader(); const len=+res.headers.get('Content-Length')||0; let received=0; const chunks=[];
        while(true){ const {done, value}=await reader.read(); if(done) break; chunks.push(value); received+=value.length; if(len){ bar.style.width=((received/len)*100).toFixed(1)+'%'; } }
        stopOrbit(); bar.style.width='100%';
        const blob=new Blob(chunks); const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download=(url.split('/').pop()||'download.bin'); a.click(); URL.revokeObjectURL(a.href);
      }catch(e){ stopOrbit(); console.error(e); }
    }
    async function runQueue(urls){
      for(let i=0;i<urls.length;i++){ const url=urls[i].trim(); if(!url) continue; await downloadOne(url, orbitSide); orbitSide*=-1; }
    }
    dlQueueBtn.onclick=()=>{ queue.innerHTML=''; const urls=urlsEl.value.split(/\n+/).filter(Boolean); runQueue(urls); };
    dlClearBtn.onclick=()=>{ queue.innerHTML=''; };

    // expose
    window.showASCIIAnim = (script)=>{ openMenu(); tabs.forEach(t=>t.classList.remove('active')); tabs.find(t=>t.dataset.tab==='asc').classList.add('active'); Object.values(panels).forEach(p=>p.classList.remove('show')); panels['asc'].classList.add('show'); showASCIIAnim(script); };
    function showASCIIAnim(script){
      // quick overlay inside this version
      const overlay=document.createElement('div'); overlay.style.cssText="position:fixed;left:10px;right:10px;top:64px;z-index:40;font-family:ui-monospace,monospace;color:#eaffff;white-space:pre;text-align:center;pointer-events:none;text-shadow:0 0 14px rgba(0,255,255,.4);opacity:0;transform:translateY(-8px);transition:opacity .18s ease, transform .18s ease;";
      document.body.appendChild(overlay);
      let fps=6, dur=1600; const header=script.match(/^@([^\n]+)\n/); if(header){ const h=header[1]; script=script.slice(header[0].length); const fpsM=h.match(/fps:(\d+)/i); const durM=h.match(/dur:(\d+)/i); if(fpsM) fps=+fpsM[1]; if(durM) dur=+durM[1]; }
      const frames=script.split(/\n---\n/); overlay.style.opacity='1'; overlay.style.transform='translateY(0)'; overlay.textContent=frames[0];
      let i=0; const step=1000/Math.max(1,fps); const t=setInterval(()=>{ i=(i+1)%frames.length; overlay.textContent=frames[i]; }, step);
      setTimeout(()=>{ overlay.style.opacity='0'; overlay.style.transform='translateY(-8px)'; clearInterval(t); overlay.remove(); }, dur);
    }
  </script>
</body>
</html>