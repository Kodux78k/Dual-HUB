<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>A.Infodose ‚Äî Trinity 369 ‚Ä¢ v2.4.5 (CDN Edition)</title>
  <meta name="theme-color" content="#141823" />
  <meta name="description" content="Homepage da Infodose com fluxos Trinity 369, doses, arqu√©tipos, prompts, modo empresarial, decodificador, gera√ß√£o de ID, QR e mais." />

  <!-- Icons -->
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='96' height='96'%3E%3Ctext y='.9em' font-size='90'%3Eüíä%3C/text%3E%3C/svg%3E">
  <link rel="apple-touch-icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAQAAAB..." />

  <!-- Fonts -->
  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">

  <!-- Toastify (toasts bonitos) -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/toastify-js@1.12.0/src/toastify.min.css">

  <!-- Estilos base -->
  <style>
    :root{
      --bg:#0f1115; --panel:#141823; --muted:#8891a7; --text:#e6ebff;
      --brand:#7c4dff; --accent:#34d399; --danger:#ff6b6b; --pill:#ffd166;
      --line:#202537; --card:#0c0f17; --ok:#34d399; --warn:#ffd166; --err:#ff6b6b;
    }
    [data-theme="light"]{
      --bg:#f7f8fc; --panel:#ffffff; --muted:#4b5565; --text:#111827;
      --brand:#6d28d9; --accent:#059669; --danger:#dc2626; --pill:#ca8a04;
      --line:#e5e7eb; --card:#f3f4f6; --ok:#059669; --warn:#b45309; --err:#dc2626;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;background:var(--bg);color:var(--text);
      font:14px/1.45 Inter,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial;
      letter-spacing:.1px;
    }
    a{color:var(--brand);text-decoration:none}
    .shell{
      display:grid;grid-template-columns:300px 1fr;grid-template-rows:auto 1fr auto;gap:0;min-height:100vh;
      grid-template-areas:"sidebar header" "sidebar main" "sidebar footer";
    }
    header{
      grid-area:header;background:var(--panel);border-bottom:1px solid var(--line);
      display:flex;align-items:center;gap:12px;padding:10px 14px;position:sticky;top:0;z-index:50;
    }
    .logo{display:flex;align-items:center;gap:8px;font-weight:800}
    .chip{padding:4px 8px;border:1px solid var(--line);border-radius:999px;color:var(--muted);font-size:12px}
    .grow{flex:1}
    .btn{
      border:1px solid var(--line);background:transparent;color:var(--text);
      padding:8px 10px;border-radius:10px;cursor:pointer;display:inline-flex;gap:8px;align-items:center;font-weight:600
    }
    .btn.primary{background:var(--brand);border-color:transparent}
    .btn.success{background:var(--accent);color:#07110b;border-color:transparent}
    .btn.danger{background:var(--danger);border-color:transparent}
    .btn.ghost{background:transparent}
    .btn:disabled{opacity:.6;cursor:not-allowed}
    .field{display:flex;gap:8px;align-items:center}
    .field input,.field select,.field textarea{
      background:var(--card);border:1px solid var(--line);color:var(--text);
      padding:8px 10px;border-radius:10px;outline:none;min-width:0;font-family:inherit
    }
    .field textarea{width:100%;min-height:100px;resize:vertical}
    aside{
      grid-area:sidebar;background:var(--panel);border-right:1px solid var(--line);
      display:flex;flex-direction:column;gap:12px;padding:14px;position:sticky;top:0;height:100vh;overflow:auto;
    }
    .section{display:flex;flex-direction:column;gap:10px}
    .section h3{margin:8px 0 0 0;font-size:12px;color:var(--muted);text-transform:uppercase;letter-spacing:.12em}
    .row{display:flex;align-items:center;justify-content:space-between;gap:10px}
    .toggle{position:relative;width:50px;height:28px}
    .toggle input{display:none}
    .slider{
      position:absolute;inset:0;background:#2a3146;border-radius:999px;transition:.2s;border:1px solid var(--line);
    }
    .slider:before{
      content:"";position:absolute;height:22px;width:22px;left:3px;top:2.5px;background:#fff;border-radius:50%;transition:.2s;
    }
    .toggle input:checked + .slider{background:linear-gradient(90deg,var(--brand),var(--accent))}
    .toggle input:checked + .slider:before{transform:translateX(22px)}
    main{grid-area:main;padding:16px;display:grid;grid-template-rows:auto 1fr;gap:12px;overflow:auto}
    .tabs{display:flex;gap:8px;flex-wrap:wrap}
    .tab{
      padding:8px 12px;border:1px solid var(--line);border-radius:10px;background:var(--panel);cursor:pointer;color:var(--muted);font-weight:600
    }
    .tab.active{background:var(--brand);color:#fff;border-color:transparent}
    .views{position:relative}
    .view{display:none;gap:12px}
    .view.active{display:grid}
    .grid{display:grid;gap:12px}
    .grid.cols-2{grid-template-columns:1.1fr .9fr}
    .grid.cols-3{grid-template-columns:repeat(3,1fr)}
    .card{
      background:var(--panel);border:1px solid var(--line);border-radius:12px;padding:12px;display:flex;flex-direction:column;gap:10px;
    }
    .badge{display:inline-flex;align-items:center;gap:6px;padding:4px 8px;border-radius:999px;border:1px dashed var(--line);color:var(--muted);font-size:12px}
    .kbd{font-family:JetBrains Mono,ui-monospace,SFMono-Regular,Menlo,Consolas,monospace;font-size:12px;padding:2px 6px;border:1px solid var(--line);border-radius:6px;background:var(--card)}
    .list{display:flex;flex-direction:column;gap:8px}
    iframe{width:100%;min-height:440px;border:1px solid var(--line);border-radius:12px;background:#000}
    .prompt{background:var(--card);border:1px dashed var(--line);border-radius:10px;padding:8px}
    .flex{display:flex;gap:8px;align-items:center}
    .right{margin-left:auto}
    .mono{font-family:JetBrains Mono,ui-monospace,Consolas,monospace;font-size:12px;white-space:pre-wrap}
    footer{
      grid-area:footer;border-top:1px solid var(--line);padding:10px 14px;color:var(--muted);display:flex;gap:12px;align-items:center;
      background:linear-gradient(180deg,transparent,rgba(0,0,0,.08));
    }
    .hidden{display:none !important}
    @media (max-width: 980px){
      .shell{grid-template-columns:1fr;grid-template-areas:"header" "main" "footer"}
      aside{position:static;height:auto;order:2}
      .grid.cols-2{grid-template-columns:1fr}
      .grid.cols-3{grid-template-columns:1fr}
    }
  </style>
</head>
<body data-theme="dark">
  <div class="shell" id="app">
    <!-- HEADER -->
    <header>
      <div class="logo">
        <span style="font-size:20px">üíä</span>
        <span style="font-weight:800">A.Infodose</span>
        <span class="chip">v2.4.5</span>
        <span class="chip">Trinity 369</span>
        <span class="chip">CDN</span>
      </div>
      <div class="grow"></div>
      <div class="field">
        <button class="btn" id="toggleTheme" title="Alternar tema">üåó Tema</button>
        <button class="btn" id="btnPWA" title="Instalar como app (PWA)">üì≤ App</button>
      </div>
      <button class="btn success" id="btnSave">Salvar</button>
    </header>

    <!-- SIDEBAR -->
    <aside>
      <div class="section">
        <h3>Estados ¬∑ ON/OFF</h3>
        <div class="row"><span>‚ö° Kodux</span>
          <label class="toggle"><input type="checkbox" id="tgKodux" checked><span class="slider"></span></label>
        </div>
        <div class="row"><span>üîê Chave Mestra</span>
          <label class="toggle"><input type="checkbox" id="tgChave" checked><span class="slider"></span></label>
        </div>
        <div class="row"><span>ü§ñ Modo MHM</span>
          <label class="toggle"><input type="checkbox" id="tgMHM" checked><span class="slider"></span></label>
        </div>
        <div class="row"><span>üíä Infodose</span>
          <label class="toggle"><input type="checkbox" id="tgInfodose" checked><span class="slider"></span></label>
        </div>
        <div class="row"><span>üè¢ Empresarial</span>
          <label class="toggle"><input type="checkbox" id="tgBiz"><span class="slider"></span></label>
        </div>
        <div class="row"><span>üé§ Voz</span>
          <label class="toggle"><input type="checkbox" id="tgVoz"><span class="slider"></span></label>
        </div>
      </div>

      <div class="section">
        <h3>Perfil</h3>
        <div class="field"><input id="inpNome" placeholder="Seu nome" /></div>
        <div class="field">
          <select id="selAssist">
            <option value="Atlas">Atlas A.Infodose</option>
            <option value="Nova">Nova A.Infodose</option>
            <option value="Vitalis">Vitalis A.Infodose</option>
            <option value="Pulse">Pulse A.Infodose</option>
            <option value="Aion">Aion A.Infodose</option>
          </select>
        </div>
        <div class="field">
          <select id="selArquetipo">
            <option>Explorador</option><option>Governante</option><option>Cuidador</option>
            <option>Magista</option><option>Art√≠fice</option><option>Guardi√£o</option>
          </select>
        </div>
        <button class="btn" id="btnGerarComando">Gerar Comando</button>
        <div id="comandoBox" class="mono"></div>
      </div>

      <div class="section">
        <h3>Config</h3>
        <div class="list">
          <button class="btn" id="btnExportCfg">Exportar config</button>
          <label class="btn ghost">
            Importar config
            <input type="file" id="fileImport" accept="application/json" class="hidden">
          </label>
          <button class="btn" id="btnDownloadHtml" title="Baixar esta p√°gina com o estado atual">Baixar HTML</button>
        </div>
      </div>

      <div class="section">
        <h3>Atalhos</h3>
        <div class="list">
          <button class="btn" data-open-tab="dashboard">üè† Dashboard</button>
          <button class="btn" data-open-tab="links">üîó Links</button>
          <button class="btn" data-open-tab="doses">üíä Doses</button>
          <button class="btn" data-open-tab="trinity">üî∫ Trinity 369</button>
          <button class="btn" data-open-tab="prompts">‚úçÔ∏è Prompts</button>
          <button class="btn" data-open-tab="tools">üß∞ Ferramentas</button>
          <button class="btn" data-open-tab="empresa">üè¢ Empresarial</button>
          <button class="btn" data-open-tab="lab">üß™ Lab</button>
        </div>
      </div>
    </aside>

    <!-- MAIN -->
    <main>
      <div class="tabs" id="tabs">
        <button class="tab active" data-tab="dashboard">üè† Dashboard</button>
        <button class="tab" data-tab="links">üîó Links/iframe</button>
        <button class="tab" data-tab="doses">üíä Doses+Arqu√©tipos</button>
        <button class="tab" data-tab="trinity">üî∫ Trinity 369</button>
        <button class="tab" data-tab="prompts">‚úçÔ∏è Prompts</button>
        <button class="tab" data-tab="tools">üß∞ Ferramentas</button>
        <button class="tab" data-tab="empresa">üè¢ Empresarial</button>
        <button class="tab" data-tab="lab">üß™ Lab/MD/QR</button>
      </div>

      <div class="views">
        <!-- DASHBOARD -->
        <section class="view active" id="view-dashboard">
          <div class="grid cols-2">
            <div class="card">
              <div class="flex">
                <h2>Estado do Sistema</h2>
                <span class="right badge">LocalStorage</span>
              </div>
              <div class="list mono" id="statusList"></div>
              <div class="flex">
                <button class="btn success" id="btnAtivarTudo">Ativar Tudo</button>
                <button class="btn" id="btnDesativarTudo">Desativar Tudo</button>
                <span class="right chip">KODUX ‚úÖ</span>
              </div>
            </div>

            <div class="card">
              <h2>Comando de Ativa√ß√£o</h2>
              <div class="field">
                <input id="inpComando" class="mono" readonly placeholder="Seu comando aparecer√° aqui‚Ä¶" />
                <button class="btn" data-copy="#inpComando">Copiar</button>
                <button class="btn" id="btnSpeak">üîä Falar</button>
              </div>
              <div class="list">
                <div class="badge">Diga: <span class="mono" id="falaCmd"></span></div>
                <div class="badge">Digite: <span class="mono" id="digitaCmd"></span></div>
              </div>
            </div>
          </div>

          <div class="grid cols-3">
            <div class="card">
              <h3>üíä Doses</h3>
              <div class="list">
                <div>Modo: <span id="doseModo" class="badge">Equilibrado</span></div>
                <div>Pr√≥xima: <span id="doseProx" class="badge">1¬™ dose</span></div>
                <button class="btn" id="btnAplicarDose">Aplicar dose</button>
                <div id="doseLog" class="mono"></div>
              </div>
            </div>
            <div class="card">
              <h3>üî∫ Trinity 369</h3>
              <div class="list">
                <div>Passo atual: <span id="triPasso" class="badge">1‚Üí2</span></div>
                <button class="btn" id="triAvancar">Avan√ßar fluxo</button>
                <div class="mono" id="triLog"></div>
              </div>
            </div>
            <div class="card">
              <h3>üß† Arqu√©tipo ativo</h3>
              <div class="list">
                <div class="badge" id="arkBadge">Explorador</div>
                <div id="arkInsight" class="mono"></div>
              </div>
            </div>
          </div>
        </section>

        <!-- LINKS -->
        <section class="view" id="view-links">
          <div class="grid cols-2">
            <div class="card">
              <h2>Gerenciador de Links</h2>
              <div class="field"><input id="linkNome" placeholder="Nome amig√°vel" /></div>
              <div class="field"><input id="linkUrl" placeholder="URL (https://‚Ä¶)" /></div>
              <div class="flex">
                <button class="btn" id="btnAddLink">Adicionar</button>
                <button class="btn" id="btnImportLinks">Importar .json</button>
                <button class="btn" id="btnExportLinks">Exportar .json</button>
                <button class="btn danger right" id="btnClearLinks">Limpar</button>
              </div>
              <div class="list" id="listaLinks"></div>
              <div class="badge">‚ö†Ô∏è Alguns sites bloqueiam iframe.</div>
            </div>
            <div class="card">
              <h2>Visualizador</h2>
              <iframe id="viewer" sandbox="allow-same-origin allow-scripts allow-forms allow-popups" src="about:blank"></iframe>
            </div>
          </div>
        </section>

        <!-- DOSES -->
        <section class="view" id="view-doses">
          <div class="grid cols-2">
            <div class="card">
              <h2>Assistente & Dose</h2>
              <div class="field">
                <label>Assistente</label>
                <select id="doseAssist">
                  <option>Atlas</option><option>Nova</option><option>Vitalis</option><option>Pulse</option><option>Aion</option>
                </select>
              </div>
              <div class="field">
                <label>Modo</label>
                <select id="doseModeSel">
                  <option>Foco</option><option>Explorador</option><option selected>Equilibrado</option>
                </select>
              </div>
              <div class="field">
                <label>Dose n¬∫</label>
                <input id="doseNum" type="number" min="1" value="1" />
              </div>
              <button class="btn success" id="btnGerarDose">Gerar Plano</button>
              <div id="dosePlano" class="prompt mono"></div>
            </div>
            <div class="card">
              <h2>Arqu√©tipos</h2>
              <div class="list">
                <div class="field">
                  <label>Elemento</label>
                  <select id="selElemento">
                    <option>Fogo</option><option>√Ågua</option><option>Terra</option><option>Madeira</option><option>Metal</option>
                  </select>
                </div>
                <button class="btn" id="btnMapearArk">Mapear</button>
                <div id="arkMapa" class="prompt mono"></div>
              </div>
            </div>
          </div>
        </section>

        <!-- TRINITY 369 -->
        <section class="view" id="view-trinity">
          <div class="card">
            <h2>Fluxo Monodual Trinity 369</h2>
            <div class="list">
              <div class="mono">Regra: uma a√ß√£o ‚ûú 2 possibilidades ‚ûú 3¬™ intera√ß√£o (s√≠ntese) ‚ûú loop (3-6-9).</div>
              <div class="grid cols-3">
                <div class="card">
                  <h3>1 ‚Äî A√ß√£o</h3>
                  <div class="list">
                    <button class="btn primary" data-tri="acao" data-val="Iniciar">Iniciar</button>
                    <button class="btn" data-tri="acao" data-val="Refinar">Refinar</button>
                    <button class="btn" data-tri="acao" data-val="Explorar">Explorar</button>
                  </div>
                </div>
                <div class="card">
                  <h3>2 ‚Äî Possibilidades</h3>
                  <div class="list" id="triPoss"></div>
                </div>
                <div class="card">
                  <h3>3 ‚Äî S√≠ntese</h3>
                  <div class="list" id="triSintese"></div>
                </div>
              </div>
              <div class="flex">
                <button class="btn" id="triReset">Reset</button>
                <span class="right badge">Ciclo: <span id="triCiclo">0</span></span>
              </div>
            </div>
          </div>
        </section>

        <!-- PROMPTS -->
        <section class="view" id="view-prompts">
          <div class="grid cols-3">
            <div class="card">
              <h2>Prompts de Ativa√ß√£o</h2>
              <div class="prompt" data-prompt>
                <div class="mono">[NOME], ativar [ASSISTENTE] A.Infodose. Modo [MODO]. Objetivo: [OBJETIVO].</div>
                <div class="flex"><button class="btn right" data-copy-prev>Copiar</button></div>
              </div>
              <div class="prompt" data-prompt>
                <div class="mono">Fluxo Trinity 369: proponha 2 vias, s√≠ntese, e repita ciclos at√© 3.</div>
                <div class="flex"><button class="btn right" data-copy-prev>Copiar</button></div>
              </div>
              <div class="prompt" data-prompt>
                <div class="mono">Arquet√≠pico: cor atual, movimento (¬±), elemento (F/A/T/Md/Me), sugerir arqu√©tipo.</div>
                <div class="flex"><button class="btn right" data-copy-prev>Copiar</button></div>
              </div>
            </div>
            <div class="card">
              <h2>Prompts Empresariais</h2>
              <div class="prompt" data-prompt>
                <div class="mono">Crie OKRs trimestrais (3 objetivos, 3-5 KRs) ligados ao 369.</div>
                <div class="flex"><button class="btn right" data-copy-prev>Copiar</button></div>
              </div>
              <div class="prompt" data-prompt>
                <div class="mono">Matriz RACI do projeto [X]: pap√©is, entregas, prazos, riscos e mitiga√ß√£o.</div>
                <div class="flex"><button class="btn right" data-copy-prev>Copiar</button></div>
              </div>
              <div class="prompt" data-prompt>
                <div class="mono">Roadmap 90 dias: 3 √©picos, 6 sprints, 9 marcos mensur√°veis.</div>
                <div class="flex"><button class="btn right" data-copy-prev>Copiar</button></div>
              </div>
            </div>
            <div class="card">
              <h2>Prompts Criativos</h2>
              <div class="prompt" data-prompt>
                <div class="mono">Vitalis: ritual dopamina (3 h√°bitos, 6 ajustes, 9 microvit√≥rias).</div>
                <div class="flex"><button class="btn right" data-copy-prev>Copiar</button></div>
              </div>
              <div class="prompt" data-prompt>
                <div class="mono">Pulse: ideias √°udio-branding + plano de testes A/B + KPIs.</div>
                <div class="flex"><button class="btn right" data-copy-prev>Copiar</button></div>
              </div>
              <div class="prompt" data-prompt>
                <div class="mono">Nova: 10 conceitos ‚Üí selecione 2 vias ‚Üí 1 s√≠ntese diferenciada.</div>
                <div class="flex"><button class="btn right" data-copy-prev>Copiar</button></div>
              </div>
            </div>
          </div>
        </section>

        <!-- FERRAMENTAS -->
        <section class="view" id="view-tools">
          <div class="grid cols-3">
            <div class="card">
              <h2>Decodificador</h2>
              <div class="field"><textarea id="txtIn" placeholder="Cole aqui‚Ä¶"></textarea></div>
              <div class="flex">
                <button class="btn" id="btnB64enc">Base64 ‚áß</button>
                <button class="btn" id="btnB64dec">Base64 ‚á©</button>
                <button class="btn" id="btnURLenc">URL ‚áß</button>
                <button class="btn" id="btnURLdec">URL ‚á©</button>
                <button class="btn" id="btnSHA256">SHA-256</button>
                <button class="btn" id="btnAES">AES-enc</button>
              </div>
              <div class="field"><textarea id="txtOut" placeholder="Sa√≠da‚Ä¶"></textarea></div>
              <div class="field"><input id="txtKey" placeholder="Chave (AES opcional)" /></div>
            </div>

            <div class="card">
              <h2>Gera√ß√£o de IDs</h2>
              <div class="list">
                <div class="flex"><button class="btn" id="btnUUID">UUID v4</button><input class="mono" id="outUUID" readonly></div>
                <div class="flex"><button class="btn" id="btnNano">Nano ID</button><input class="mono" id="outNano" readonly></div>
                <div class="flex"><button class="btn" id="btnShort">Short ID</button><input class="mono" id="outShort" readonly></div>
                <div class="flex"><button class="btn" id="btnQR">QR do texto</button><canvas id="qrCanvas" style="background:#fff;border-radius:8px"></canvas></div>
              </div>
            </div>

            <div class="card">
              <h2>Utilidades</h2>
              <div class="list">
                <div class="flex">
                  <button class="btn" id="btnNow">Timestamp</button>
                  <input id="outNow" class="mono" readonly>
                  <span class="badge" id="tzBadge"></span>
                </div>
                <div class="flex">
                  <button class="btn" id="btnCopyState">Copiar estado</button>
                  <button class="btn" id="btnClearState">Limpar estado</button>
                </div>
                <div class="flex">
                  <input id="mdIn" placeholder="Markdown ‚Üí HTML preview"/>
                  <button class="btn" id="btnMD">Render</button>
                </div>
                <div id="mdOut" class="prompt"></div>
              </div>
            </div>
          </div>
        </section>

        <!-- EMPRESARIAL -->
        <section class="view" id="view-empresa">
          <div class="grid cols-2">
            <div class="card">
              <h2>Modo Empresarial</h2>
              <div class="list">
                <div>Estado: <span id="bizState" class="badge">OFF</span></div>
                <div class="field"><input id="bizProjeto" placeholder="Projeto / Squad" /></div>
                <div class="field"><input id="bizMeta" placeholder="Meta principal" /></div>
                <div class="field"><input id="bizPrazo" placeholder="Prazo (ex: 30 dias)" /></div>
                <button class="btn success" id="bizGerar">Gerar Trilha</button>
                <div id="bizPlano" class="prompt mono"></div>
              </div>
            </div>
            <div class="card">
              <h2>KPIs & OKRs</h2>
              <div class="list">
                <div class="field"><textarea id="bizOKR" placeholder="Cole seus OKRs aqui ou gere acima‚Ä¶"></textarea></div>
                <div class="flex">
                  <button class="btn" data-copy="#bizOKR">Copiar</button>
                  <button class="btn danger right" id="bizClear">Limpar</button>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- LAB -->
        <section class="view" id="view-lab">
          <div class="grid cols-2">
            <div class="card">
              <h2>Editor JSON/Prompt Pack</h2>
              <div class="field"><textarea id="labJson" placeholder='Cole JSON/Prompts aqui‚Ä¶'></textarea></div>
              <div class="flex">
                <button class="btn" id="btnJSONfmt">Formatar</button>
                <button class="btn" id="btnJSONmin">Minificar</button>
                <button class="btn" id="btnDownloadTxt">Baixar .txt</button>
              </div>
            </div>
            <div class="card">
              <h2>Speech & Hotkeys</h2>
              <div class="list">
                <div class="badge">Atalhos: Ctrl+K (buscar), Ctrl+S (salvar)</div>
                <div class="field">
                  <input id="sayText" placeholder="Texto para falar‚Ä¶" />
                  <button class="btn" id="btnSay">üîä Falar</button>
                  <button class="btn" id="btnStopSay">‚èπÔ∏è Parar</button>
                </div>
                <div class="field">
                  <input id="searchAll" placeholder="Buscar no app‚Ä¶" />
                </div>
                <div id="searchHits" class="mono"></div>
              </div>
            </div>
          </div>
        </section>

      </div>
    </main>

    <!-- FOOTER -->
    <footer>
      <span>üíä A.Infodose ‚Ä¢ Local ‚Ä¢ Sem backend</span>
      <span class="right"></span>
      <span class="chip">Kodux ON</span>
      <span class="chip">Chave Mestra ON</span>
      <span class="chip">MHM ON</span>
    </footer>
  </div>

  <!-- CDNs -->
  <script src="https://cdn.jsdelivr.net/npm/toastify-js@1.12.0/src/toastify.min.js"></script>

  <!-- App (ESM) -->
  <script type="module">
    // ===== Imports via CDN =====
    import dayjs from "https://cdn.jsdelivr.net/npm/dayjs@1.11.11/+esm";
    import { nanoid, customAlphabet } from "https://cdn.jsdelivr.net/npm/nanoid@5.0.7/+esm";
    import { v4 as uuidv4 } from "https://cdn.jsdelivr.net/npm/uuid@9.0.1/+esm";
    import QRCode from "https://cdn.jsdelivr.net/npm/qrcode@1.5.4/+esm";
    import CryptoJS from "https://cdn.jsdelivr.net/npm/crypto-js@4.2.0/+esm";
    import hotkeys from "https://cdn.jsdelivr.net/npm/hotkeys-js@3.13.7/+esm";
    import { marked } from "https://cdn.jsdelivr.net/npm/marked@12.0.2/+esm";

    // ===== Helpers =====
    const $ = (q,root=document)=>root.querySelector(q);
    const $$ = (q,root=document)=>[...root.querySelectorAll(q)];
    const toast = (text, style="ok")=>{
      Toastify({
        text, gravity:"bottom", position:"right",
        className: style, style:{
          background: style==="ok"?"linear-gradient(90deg,#34d399,#10b981)"
            : style==="warn"?"linear-gradient(90deg,#f59e0b,#d97706)"
            : "linear-gradient(90deg,#ef4444,#b91c1c)"
        }, duration:1600
      }).showToast();
    };
    const copySel = (sel)=>{
      const el = typeof sel==="string" ? $(sel) : sel;
      if(!el) return toast("Nada para copiar","warn");
      const val = el.value ?? el.textContent ?? "";
      navigator.clipboard.writeText(val).then(()=>toast("Copiado!","ok"));
    };
    const save = ()=>localStorage.setItem("infodose", JSON.stringify(state));
    const load = ()=>{ try{ return JSON.parse(localStorage.getItem("infodose")||"{}"); }catch(_){return {}} };
    const nowISO = ()=> new Date().toISOString();
    const sanitizeUrl = (u)=>/^https?:\/\//i.test(u)?u:`https://${u}`;
    const speak = (t)=>{ if(!state.toggles.voz) return toast("Voz OFF","warn"); const u=new SpeechSynthesisUtterance(t); u.lang="pt-BR"; speechSynthesis.speak(u); };

    // ===== State =====
    let state = Object.assign({
      theme:"dark",
      toggles:{kodux:true,chave:true,mhm:true,infodose:true,biz:false,voz:false},
      nome:"", assist:"Atlas", arquetipo:"Explorador", elemento:"Fogo",
      doseMode:"Equilibrado", doseNum:1, doseLog:[],
      links:[
        {nome:"MDN", url:"https://developer.mozilla.org/"},
        {nome:"YouTube", url:"https://www.youtube.com/"},
        {nome:"Exemplo (RFC)", url:"https://example.com"}
      ],
      biz:{projeto:"",meta:"",prazo:"",okr:""},
      trinity:{ciclo:0, passo:"1‚Üí2", log:[]}
    }, load());

    // ===== Theme & PWA =====
    const applyTheme=()=> document.body.setAttribute('data-theme', state.theme);
    $("#toggleTheme").onclick=()=>{ state.theme = state.theme==="dark"?"light":"dark"; applyTheme(); save(); };
    applyTheme();

    // PWA (instala√ß√£o simples se hospedado com https)
    let deferredPrompt=null;
    window.addEventListener('beforeinstallprompt', (e)=>{ e.preventDefault(); deferredPrompt=e; $("#btnPWA").disabled=false; });
    $("#btnPWA").onclick=async()=>{
      if(!deferredPrompt){ toast("Indispon√≠vel","warn"); return; }
      deferredPrompt.prompt(); const { outcome } = await deferredPrompt.userChoice;
      toast(outcome==="accepted"?"Instalado!":"Cancelado", outcome==="accepted"?"ok":"warn");
      deferredPrompt=null;
    };

    // ===== Sidebar Toggles =====
    const bindToggle=(id,key)=>{ const el=$(id); el.checked=!!state.toggles[key]; el.onchange=()=>{ state.toggles[key]=el.checked; save(); renderStatus(); renderBizState(); } };
    bindToggle("#tgKodux","kodux");
    bindToggle("#tgChave","chave");
    bindToggle("#tgMHM","mhm");
    bindToggle("#tgInfodose","infodose");
    bindToggle("#tgBiz","biz");
    bindToggle("#tgVoz","voz");

    // Perfil fields
    $("#inpNome").value=state.nome||"";
    $("#selAssist").value=state.assist||"Atlas";
    $("#selArquetipo").value=state.arquetipo||"Explorador";

    // ===== Tabs / Views =====
    const tabs = $$("#tabs .tab");
    const views = {
      dashboard: $("#view-dashboard"),
      links: $("#view-links"),
      doses: $("#view-doses"),
      trinity: $("#view-trinity"),
      prompts: $("#view-prompts"),
      tools: $("#view-tools"),
      empresa: $("#view-empresa"),
      lab: $("#view-lab")
    };
    const openTab = (name)=>{
      tabs.forEach(t=>t.classList.toggle("active", t.dataset.tab===name));
      Object.entries(views).forEach(([k,v])=>v.classList.toggle("active", k===name));
      save();
    };
    tabs.forEach(t=>t.onclick=()=>openTab(t.dataset.tab));
    $$("aside [data-open-tab]").forEach(b=>b.onclick=()=>openTab(b.dataset.openTab));

    // ===== Status =====
    function renderStatus(){
      const s = $("#statusList"); s.innerHTML = "";
      const row = (label,on)=>`<div>‚Ä¢ ${label}: <span style="color:${on?'var(--ok)':'var(--err)'}">${on?'ON':'OFF'}</span></div>`;
      s.insertAdjacentHTML('beforeend', row("‚ö° Kodux", state.toggles.kodux));
      s.insertAdjacentHTML('beforeend', row("üîê Chave Mestra", state.toggles.chave));
      s.insertAdjacentHTML('beforeend', row("ü§ñ MHM", state.toggles.mhm));
      s.insertAdjacentHTML('beforeend', row("üíä Infodose", state.toggles.infodose));
      s.insertAdjacentHTML('beforeend', row("üè¢ Empresarial", state.toggles.biz));
      s.insertAdjacentHTML('beforeend', row("üé§ Voz", state.toggles.voz));
    }
    renderStatus();

    $("#btnAtivarTudo").onclick=()=>{ Object.keys(state.toggles).forEach(k=>state.toggles[k]=true);
      ['#tgKodux','#tgChave','#tgMHM','#tgInfodose','#tgBiz','#tgVoz'].forEach(sel=>$(sel).checked=true);
      save(); renderStatus(); toast("Tudo ON","ok"); };
    $("#btnDesativarTudo").onclick=()=>{ Object.keys(state.toggles).forEach(k=>state.toggles[k]=false);
      ['#tgKodux','#tgChave','#tgMHM','#tgInfodose','#tgBiz','#tgVoz'].forEach(sel=>$(sel).checked=false);
      save(); renderStatus(); toast("Tudo OFF","warn"); };

    // ===== Save/Export/Import/Download =====
    $("#btnSave").onclick=()=>{ save(); toast("Salvo","ok"); };
    $("#btnExportCfg").onclick=()=>{
      const blob = new Blob([JSON.stringify(state,null,2)],{type:"application/json"});
      const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download="infodose-config.json"; a.click(); URL.revokeObjectURL(a.href);
    };
    $("#fileImport").onchange=(e)=>{
      const file=e.target.files[0]; if(!file) return;
      const fr=new FileReader();
      fr.onload=()=>{ try{ state=Object.assign(state, JSON.parse(fr.result)); applyTheme(); syncFromState(); save(); toast("Config importada","ok"); }catch{ toast("JSON inv√°lido","err"); } };
      fr.readAsText(file);
    };
    $("#btnDownloadHtml").onclick=()=>{
      const html = "<!doctype html>\n"+document.documentElement.outerHTML;
      const blob = new Blob([html],{type:"text/html"});
      const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download="infodose-homepage.html"; a.click(); URL.revokeObjectURL(a.href);
      toast("HTML baixado","ok");
    };

    // ===== Gerar Comando =====
    $("#btnGerarComando").onclick=genCommand;
    function genCommand(){
      state.nome=$("#inpNome").value.trim();
      state.assist=$("#selAssist").value;
      state.arquetipo=$("#selArquetipo").value;
      const cmdFalado = `${state.nome||"Usu√°rio"}, ativar ${state.assist} A.Infodose`;
      const cmdDigitado = `1+${state.assist}`;
      $("#comandoBox").textContent = cmdFalado;
      $("#inpComando").value = `${cmdFalado} ‚Ä¢ ${cmdDigitado}`;
      $("#falaCmd").textContent = cmdFalado;
      $("#digitaCmd").textContent = cmdDigitado;
      save(); toast("Comando gerado","ok");
    }
    genCommand();

    // Speech buttons
    $("#btnSpeak").onclick=()=>{ const t=$("#inpComando").value||"Nada"; speak(t); };

    // ===== Links / Iframe =====
    const renderLinks=()=>{
      const cont=$("#listaLinks"); cont.innerHTML="";
      state.links.forEach((l,i)=>{
        const row=document.createElement('div'); row.className='row';
        const left=document.createElement('div'); left.innerHTML=`<strong>${l.nome}</strong><div class="mono">${l.url}</div>`;
        const right=document.createElement('div');
        const b1=document.createElement('button'); b1.className="btn"; b1.textContent="Abrir"; b1.onclick=()=>{ $("#viewer").src=l.url; };
        const b2=document.createElement('button'); b2.className="btn"; b2.textContent="Copiar"; b2.onclick=()=>{ navigator.clipboard.writeText(l.url).then(()=>toast("URL copiada","ok")); };
        const b3=document.createElement('button'); b3.className="btn danger"; b3.textContent="X"; b3.onclick=()=>{ state.links.splice(i,1); save(); renderLinks(); };
        right.append(b1,b2,b3);
        row.append(left,right); cont.append(row);
      });
      save();
    };
    renderLinks();
    $("#btnAddLink").onclick=()=>{
      const nome=$("#linkNome").value.trim(); const url=sanitizeUrl($("#linkUrl").value.trim());
      if(!nome||!url){ toast("Informe nome e URL","warn"); return; }
      state.links.push({nome,url}); $("#linkNome").value=""; $("#linkUrl").value=""; save(); renderLinks();
    };
    $("#btnClearLinks").onclick=()=>{ state.links=[]; save(); renderLinks(); $("#viewer").src="about:blank"; };
    $("#btnExportLinks").onclick=()=>{
      const blob = new Blob([JSON.stringify(state.links,null,2)],{type:"application/json"});
      const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download="infodose-links.json"; a.click(); URL.revokeObjectURL(a.href);
    };
    $("#btnImportLinks").onclick=()=>{
      const inp=document.createElement('input'); inp.type="file"; inp.accept="application/json";
      inp.onchange=(e)=>{ const f=e.target.files[0]; if(!f) return; const fr=new FileReader(); fr.onload=()=>{ try{ state.links=JSON.parse(fr.result); save(); renderLinks(); toast("Links importados","ok"); }catch{ toast("JSON inv√°lido","err"); } }; fr.readAsText(f); };
      inp.click();
    };

    // ===== Doses & Arqu√©tipos =====
    $("#doseAssist").value=state.assist||"Atlas";
    $("#doseModeSel").value=state.doseMode||"Equilibrado";
    $("#doseNum").value=state.doseNum||1;
    $("#doseModo").textContent=state.doseMode||"Equilibrado";
    $("#doseProx").textContent=`${state.doseNum}¬™ dose`;

    $("#btnGerarDose").onclick=()=>{
      state.assist=$("#doseAssist").value;
      state.doseMode=$("#doseModeSel").value;
      state.doseNum=parseInt($("#doseNum").value||"1",10);
      $("#doseModo").textContent=state.doseMode;
      $("#doseProx").textContent=`${state.doseNum}¬™ dose`;
      const plano = gerarPlanoDose(state.assist, state.doseMode, state.doseNum);
      $("#dosePlano").textContent=plano;
      save(); toast("Plano gerado","ok");
    };

    function gerarPlanoDose(assist, modo, n){
      const base = {
        Atlas:["Planejar","Priorizar","Executar"],
        Nova:["Idear","Prototipar","Iterar"],
        Vitalis:["Respirar","Mover","Nutrir"],
        Pulse:["Sentir","Compor","Performar"],
        Aion:["Organizar","Ambientar","Transformar"]
      }[assist] || ["A√ß√£o","Ajuste","S√≠ntese"];
      const steps = base.map((s,i)=> `${i+1}. ${s}`);
      const micros = Array.from({length:6},(_,i)=>`‚Ä¢ micro ${i+1}`).join(" | ");
      const checks = Array.from({length:9},(_,i)=> (i+1)%3===0 ? `‚úì${i+1}`:`¬∑${i+1}`).join(" ");
      return `[${assist}‚Ä¢${modo}] Dose ${n}\n${steps.join(" ‚Üí ")}\n${micros}\nCheckpoints: ${checks}`;
    }

    $("#btnMapearArk").onclick=()=>{
      state.elemento=$("#selElemento").value;
      const map = {
        Fogo:"Explorador ‚Ä¢ energia ‚Ä¢ a√ß√£o",
        √Ågua:"Cuidador ‚Ä¢ fluidez ‚Ä¢ empatia",
        Terra:"Guardi√£o ‚Ä¢ estabilidade ‚Ä¢ suporte",
        Madeira:"Art√≠fice ‚Ä¢ cria√ß√£o ‚Ä¢ crescimento",
        Metal:"Governante ‚Ä¢ foco ‚Ä¢ estrutura"
      }[state.elemento] || "Explorador";
      $("#arkMapa").textContent = `Elemento: ${state.elemento}\nArqu√©tipo sugerido: ${map}`;
      $("#arkBadge").textContent = map.split(" ‚Ä¢ ")[0];
      $("#arkInsight").textContent = `${map} ‚Äî salvo ${new Date().toLocaleString()}`;
      save();
    };

    $("#btnAplicarDose").onclick=()=>{
      const entry = `${nowISO()} ‚Ä¢ Aplicada ${state.doseNum}¬™ (${state.assist}/${state.doseMode})`;
      state.doseLog.unshift(entry);
      $("#doseLog").textContent = state.doseLog.slice(0,6).join("\n");
      state.doseNum++; $("#doseProx").textContent=`${state.doseNum}¬™ dose`;
      save();
    };

    // ===== Trinity 369 =====
    const possByAcao = {
      Iniciar:["Focar","Explorar"],
      Refinar:["Cortar","Aprimorar"],
      Explorar:["Divergir","Coletar"]
    };
    let tri = state.trinity;
    function triRender(){
      $("#triPasso").textContent = tri.passo;
      $("#triCiclo").textContent = tri.ciclo;
      $("#triLog").textContent = tri.log.slice(0,8).join("\n");
    }
    triRender();

    $$("#view-trinity [data-tri='acao']").forEach(b=>{
      b.onclick=()=>{
        const val=b.dataset.val;
        const poss = possByAcao[val] || ["Via A","Via B"];
        $("#triPoss").innerHTML = "";
        poss.forEach(p=>{
          const btn=document.createElement('button'); btn.className='btn'; btn.textContent=p;
          btn.onclick=()=>triSintetizar(val,p);
          $("#triPoss").append(btn);
        });
        tri.passo="2‚Üí3";
        tri.log.unshift(`${nowISO()} ‚Ä¢ 1:${val} ‚Üí 2:${poss.join("/")}`);
        save(); triRender();
      };
    });
    function triSintetizar(acao, via){
      const s = `S√≠ntese(${acao}+${via})`;
      const btn=document.createElement('button'); btn.className='btn primary'; btn.textContent=s;
      btn.onclick=()=>{
        tri.ciclo++; tri.passo="1‚Üí2";
        tri.log.unshift(`${nowISO()} ‚Ä¢ 3:${s} ‚úì ciclo ${tri.ciclo}`);
        $("#triPoss").innerHTML=""; $("#triSintese").innerHTML="";
        save(); triRender();
      };
      $("#triSintese").innerHTML=""; $("#triSintese").append(btn);
      tri.passo="3‚Üí1";
      tri.log.unshift(`${nowISO()} ‚Ä¢ 2:${via} ‚Üí 3:${s}`);
      save(); triRender();
    }
    $("#triAvancar").onclick=()=>toast("Escolha 1‚Üí2‚Üí3 para avan√ßar","warn");
    $("#triReset").onclick=()=>{ tri={ciclo:0,passo:"1‚Üí2",log:[]}; state.trinity=tri; $("#triPoss").innerHTML=""; $("#triSintese").innerHTML=""; save(); triRender(); };

    // ===== Ferramentas =====
    const encB64 = (s)=> btoa(unescape(encodeURIComponent(s)));
    const decB64 = (s)=> decodeURIComponent(escape(atob(s)));
    $("#btnB64enc").onclick=()=>{ $("#txtOut").value = encB64($("#txtIn").value); };
    $("#btnB64dec").onclick=()=>{ try{ $("#txtOut").value = decB64($("#txtIn").value); }catch{ toast("Base64 inv√°lido","err"); } };
    $("#btnURLenc").onclick=()=>{ $("#txtOut").value = encodeURIComponent($("#txtIn").value); };
    $("#btnURLdec").onclick=()=>{ $("#txtOut").value = decodeURIComponent($("#txtIn").value); };
    $("#btnSHA256").onclick=()=>{ $("#txtOut").value = CryptoJS.SHA256($("#txtIn").value).toString(); };
    $("#btnAES").onclick=()=>{ const k=$("#txtKey").value||"infodose"; const c=CryptoJS.AES.encrypt($("#txtIn").value,k).toString(); $("#txtOut").value=c; };

    // IDs + QR
    $("#btnUUID").onclick=()=>{ $("#outUUID").value=uuidv4(); };
    $("#btnNano").onclick=()=>{ $("#outNano").value=nanoid(); };
    $("#btnShort").onclick=()=>{ $("#outShort").value=customAlphabet('0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz',10)(); };
    $("#btnQR").onclick=async()=>{ const txt=$("#txtIn").value||"A.Infodose"; await QRCode.toCanvas($("#qrCanvas"), txt, {width:160}); toast("QR gerado","ok"); };

    // Utilidades
    $("#btnNow").onclick=()=>{ $("#outNow").value = dayjs().toISOString(); $("#tzBadge").textContent = Intl.DateTimeFormat().resolvedOptions().timeZone; };
    $("#btnCopyState").onclick=()=>{ navigator.clipboard.writeText(JSON.stringify(state,null,2)).then(()=>toast("Estado copiado","ok")); };
    $("#btnClearState").onclick=()=>{ localStorage.removeItem("infodose"); toast("Estado limpo","ok"); };
    $("#btnMD").onclick=()=>{ $("#mdOut").innerHTML = marked.parse($("#mdIn").value||""); };

    // ===== Empresarial =====
    function renderBizState(){ $("#bizState").textContent = state.toggles.biz ? "ON" : "OFF"; }
    renderBizState();
    $("#bizGerar").onclick=()=>{
      state.biz.projeto=$("#bizProjeto").value.trim();
      state.biz.meta=$("#bizMeta").value.trim();
      state.biz.prazo=$("#bizPrazo").value.trim();
      const trilha = [
        "1. Descoberta ‚Üí 2 vias: Pesquisa / Stakeholders",
        "2. S√≠ntese (Canvas + Riscos) ‚Üí Ciclo 1",
        "3. Execu√ß√£o 1 ‚Üí 2 vias: Build / Medir",
        "4. S√≠ntese (OKRs/KPIs) ‚Üí Ciclo 2",
        "5. Execu√ß√£o 2 ‚Üí 2 vias: Escalar / Padronizar",
        "6. S√≠ntese (Rituais) ‚Üí Ciclo 3",
        "9. Encerrar ‚Üí Li√ß√µes + Pr√≥x 3"
      ].join("\n");
      const plano = `[Projeto] ${state.biz.projeto || "N/D"}\n[Meta] ${state.biz.meta || "Crescer com qualidade"}\n[Prazo] ${state.biz.prazo || "N/D"}\n---\nFluxo 369 empresarial:\n${trilha}`;
      $("#bizPlano").textContent = plano;
      $("#bizOKR").value = `OBJ1: ${state.biz.meta || "Crescer com qualidade"}\n- KR1: m√©trica A\n- KR2: m√©trica B\n\nOBJ2: Entregar valor previs√≠vel\n- KR1: lead time\n- KR2: NPS\n\nOBJ3: Efici√™ncia\n- KR1: custo/unidade\n- KR2: margem`;
      save(); toast("Trilha gerada","ok");
    };
    $("#bizClear").onclick=()=>{ $("#bizOKR").value=""; };

    // ===== LAB =====
    $("#btnJSONfmt").onclick=()=>{ try{ $("#labJson").value = JSON.stringify(JSON.parse($("#labJson").value), null, 2); toast("Formatado","ok"); }catch{ toast("JSON inv√°lido","err"); } };
    $("#btnJSONmin").onclick=()=>{ try{ $("#labJson").value = JSON.stringify(JSON.parse($("#labJson").value)); toast("Minificado","ok"); }catch{ toast("JSON inv√°lido","err"); } };
    $("#btnDownloadTxt").onclick=()=>{ const blob=new Blob([$("#labJson").value||""],{type:"text/plain"}); const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download="prompts-pack.txt"; a.click(); URL.revokeObjectURL(a.href); };

    // ===== Busca global & Hotkeys =====
    const allTextNodes = ()=> [...document.querySelectorAll("main .card, main .prompt, main .mono")].map(n=>n.innerText).join("\n").toLowerCase();
    $("#searchAll").addEventListener("input", (e)=>{
      const q=e.target.value.toLowerCase(); if(!q){ $("#searchHits").textContent=""; return; }
      const text = allTextNodes(); const hits = text.split("\n").filter(line=>line.includes(q)).slice(0,20);
      $("#searchHits").textContent = hits.join("\n");
    });
    hotkeys('ctrl+k, command+k',(e)=>{ e.preventDefault(); $("#searchAll").focus(); });
    hotkeys('ctrl+s, command+s',(e)=>{ e.preventDefault(); save(); toast("Salvo (Ctrl+S)","ok"); });

    // ===== Copiar bot√µes (prompts e campos) =====
    $$("[data-copy]").forEach(b=> b.onclick=()=>copySel(b.getAttribute("data-copy")));
    $$("[data-copy-prev]").forEach(b=> b.onclick=()=> copySel(b.parentElement.previousElementSibling));

    // ===== Sincronizar ao carregar =====
    function syncFromState(){
      $("#inpNome").value=state.nome||""; $("#selAssist").value=state.assist||"Atlas"; $("#selArquetipo").value=state.arquetipo||"Explorador";
      $("#doseAssist").value=state.assist||"Atlas"; $("#doseModeSel").value=state.doseMode||"Equilibrado"; $("#doseNum").value=state.doseNum||1;
      $("#doseModo").textContent=state.doseMode||"Equilibrado"; $("#doseProx").textContent=`${state.doseNum}¬™ dose`;
      $("#arkBadge").textContent=state.arquetipo||"Explorador";
      ["#tgKodux","#tgChave","#tgMHM","#tgInfodose","#tgBiz","#tgVoz"].forEach((sel,i)=>$(sel).checked=Object.values(state.toggles)[i]);
      renderStatus(); renderBizState(); renderLinks(); genCommand(); triRender();
    }
    syncFromState();

    // ===== Sauda√ß√£o de criador =====
    if(state.toggles.kodux){ setTimeout(()=>toast("Criador reconhecido: KODUX ‚Ä¢ Chave Mestra ‚úÖ","ok"),800); }
  </script>
</body>
</html>