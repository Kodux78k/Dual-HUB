<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"/>
  <title>Dual.Infodose â€” Nebula Pro (Orbits â€¢ Sound â€¢ Palettes â€¢ ASCIIâ€‘DSL)</title>
  <meta name="theme-color" content="#0b0b0f"/>
  <style>
    :root{
      --ink:#eef2ff; --muted:#aeb7d6; --border:rgba(255,255,255,.16);
      --panel:rgba(0,0,0,.45); --radius:18px; --safe: env(safe-area-inset-bottom, 16px);
      --glow:0 0 28px rgba(255,255,255,.14), 0 0 64px rgba(255,255,255,.10);
      --grad: linear-gradient(42deg,#f0f,#0ff);
    }
    *{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
    html,body{height:100%}
    body{
      margin:0; color:var(--ink);
      background:
        radial-gradient(1200px 700px at 50% -20%, rgba(255,255,255,.06), transparent 60%),
        radial-gradient(900px 900px at 50% 120%, rgba(255,255,255,.05), transparent 60%),
        var(--grad);
      background-attachment: fixed;
      font: 400 16px/1.38 ui-rounded, system-ui, -apple-system, Inter, Segoe UI, Roboto, Arial;
      display:flex; flex-direction:column;
      transition: background .4s ease;
    }
    header{position:sticky; top:0; z-index:5; display:flex; justify-content:space-between; align-items:center;
      padding:14px 16px calc(10px + var(--safe)) 16px; background:linear-gradient(to bottom, rgba(0,0,0,.55), rgba(0,0,0,.25) 70%, transparent);
      backdrop-filter: blur(14px); border-bottom:1px solid var(--border)}
    .brand{display:flex; gap:10px; align-items:center}
    .pill{width:90px;height:40px;border-radius:24px;overflow:hidden;display:grid;place-items:center;background:#07070a;box-shadow:inset 0 0 0 1px rgba(255,255,255,.10), var(--glow)}
    .menuBtn{width:44px;height:44px;border-radius:14px;background:rgba(255,255,255,.08);display:grid;place-items:center;border:1px solid var(--border);box-shadow:var(--glow)}
    main{flex:1; display:flex; flex-direction:column; padding:12px 14px 0 14px; gap:12px;}
    .card{background:var(--panel); border:1px solid var(--border); border-radius:var(--radius); padding:12px; box-shadow:var(--glow); backdrop-filter: blur(8px)}
    .center{display:grid; place-items:center}
    .symbolPad{width:min(86vw, 440px); aspect-ratio: 2.2 / 1; position:relative; display:grid; place-items:center; border-radius:30px; background:#07070a; overflow:hidden; box-shadow:inset 0 0 0 2px rgba(255,255,255,.12), var(--glow)}
    .symbolPad .ring{position:absolute; inset:0; border-radius:30px; box-shadow:inset 0 0 0 2px rgba(255,255,255,.10)}
    .symbolPad .ring.r2{inset:8px; animation:pulse 3.4s ease-in-out infinite}
    .symbolPad .ring.r3{inset:16px; animation:pulse 3.4s ease-in-out .9s infinite}
    @keyframes pulse{0%,100%{box-shadow:inset 0 0 0 2px rgba(255,255,255,.10)}50%{box-shadow:inset 0 0 0 2px rgba(255,255,255,.26)}}
    .row{display:flex; gap:10px; align-items:center; justify-content:space-between; flex-wrap:wrap}
    .chip{flex:1 1 auto; min-width:120px; display:flex; align-items:center; justify-content:center; gap:8px; padding:12px 14px; border-radius:16px; border:1px solid var(--border); background:linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.04))}
    #chat{display:flex; flex-direction:column; gap:8px; height:46vh}
    .log{flex:1; overflow:auto; padding:10px 6px; display:flex; flex-direction:column; gap:8px; scroll-behavior:smooth}
    .msg{max-width:86%; padding:10px 12px; border-radius:14px; border:1px solid var(--border); box-shadow:var(--glow); white-space:pre-wrap}
    .you{align-self:flex-end; background:rgba(255,255,255,.10)}
    .ai{align-self:flex-start; background:rgba(0,0,0,.25)}
    .bar{display:flex; gap:8px; align-items:center}
    input, textarea{background:#0b0b12; color:var(--ink); border:1px solid var(--border); border-radius:12px; padding:12px 12px; width:100%}
    button{background:#0e0e16; color:var(--ink); border:1px solid rgba(255,255,255,.22); border-radius:12px; padding:12px 16px; font-weight:700}
    small{color:var(--muted)}
    .toggles{display:flex; gap:8px; align-items:center}
    .toggleBtn{display:inline-flex; align-items:center; gap:8px; padding:10px 12px; border-radius:14px; border:1px solid var(--border); background:rgba(255,255,255,.08); box-shadow:var(--glow); font-weight:700}
    .toggleBtn .dot{width:10px;height:10px;border-radius:50%;background:#aaa}
    .toggleBtn.on{background:rgba(255,255,255,.16)}
    .toggleBtn.on .dot{background:#5ef3ff; box-shadow:0 0 12px #5ef3ffaa}
    /* face moods */
    .mood{filter: drop-shadow(0 0 16px rgba(255,255,255,.22)); transition: filter .2s ease}
    .m-thinking{filter: drop-shadow(0 0 16px rgba(255,255,0,.35))}
    .m-speaking{filter: drop-shadow(0 0 16px rgba(0,255,255,.35))}
    .m-saved{filter: drop-shadow(0 0 16px rgba(0,255,128,.45))}
    .m-error{filter: drop-shadow(0 0 16px rgba(255,64,64,.45))}
    .m-surprise{filter: drop-shadow(0 0 16px rgba(255,128,0,.5))}
    .m-excited{filter: drop-shadow(0 0 20px rgba(255,0,255,.5))}
    .m-sleep{filter: drop-shadow(0 0 20px rgba(128,128,255,.45))}
    /* ASCII overlay */
    .ascii{
      position:fixed; left:10px; right:10px; top:64px; z-index:6;
      font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
      color:#eaffff; white-space:pre; text-align:center; pointer-events:none;
      text-shadow:0 0 14px rgba(0,255,255,.4);
      opacity:0; transform:translateY(-8px); transition:opacity .18s ease, transform .18s ease;
    }
    .ascii.show{opacity:1; transform:translateY(0)}
    /* download section */
    .dl{display:flex; gap:8px; margin-top:4px}
    .progress{height:10px; border-radius:8px; background:rgba(255,255,255,.12); overflow:hidden}
    .progress > div{height:100%; width:0%; background:linear-gradient(90deg,#8af,#0ff); transition:width .1s linear}
  </style>
</head>
<body>
  <header>
    <div class="brand">
      <div class="pill" id="homePill">
        <svg viewBox="0 0 120 40" width="76" height="26" aria-hidden="true">
          <path d="M10 24c12-12 22-12 34 0s22 12 34 0" stroke="white" stroke-width="4" fill="none"/>
          <path d="M10 28c12-12 22-12 34 0s22 12 34 0" stroke="white" stroke-width="3" opacity=".9" fill="none"/>
          <circle cx="45" cy="21" r="2.4" fill="white"/>
          <path d="M89 19l6 3-6 3z" fill="white"/>
        </svg>
      </div>
      <div>
        <div style="font-weight:900; letter-spacing:.4px">Dual.Infodose</div>
        <small>Orbits â€¢ Sound â€¢ Palettes â€¢ ASCIIâ€‘DSL</small>
      </div>
    </div>
    <button class="menuBtn" id="menuBtn" aria-label="Menu">
      <svg viewBox="0 0 24 24" width="22" height="22"><path d="M4 6h16M4 12h16M4 18h16" stroke="white"/></svg>
    </button>
  </header>

  <div class="ascii" id="ascii"></div>

  <main>
    <section class="center">
      <div class="symbolPad" id="pad">
        <div class="ring"></div><div class="ring r2"></div><div class="ring r3"></div>
        <svg id="face" class="mood" viewBox="0 0 120 120" width="92" height="92">
          <circle cx="60" cy="60" r="44" stroke="white" stroke-width="8" fill="none" opacity=".9"/>
          <g id="eyes">
            <ellipse id="eyeL" cx="46" cy="56" rx="13" ry="10" fill="white" opacity=".95"/>
            <ellipse id="eyeR" cx="74" cy="56" rx="13" ry="10" fill="white" opacity=".95"/>
            <circle id="pupilL" cx="46" cy="56" r="4" fill="#090a10"/>
            <circle id="pupilR" cx="74" cy="56" r="4" fill="#090a10"/>
          </g>
          <path id="mouth" d="M45 84q15 10 30 0" stroke="white" stroke-width="6" fill="none" stroke-linecap="round"/>
        </svg>
      </div>
    </section>

    <section id="chat" class="card">
      <div class="row">
        <strong>Conversas</strong>
        <div class="toggles">
          <button id="btnTTS" class="toggleBtn" aria-pressed="false"><span class="dot"></span>ðŸ”Š TTS</button>
          <button id="btnSave" class="toggleBtn on" aria-pressed="true"><span class="dot"></span>ðŸ’¾ Salvar</button>
        </div>
      </div>
      <div class="log" id="log" aria-live="polite"></div>
      <div class="bar">
        <input id="prompt" type="text" placeholder="Toque e fale com a AAâ€¦"/>
        <button id="send">Enviar</button>
      </div>
      <div class="dl">
        <input id="url" type="text" placeholder="URL para baixar (ex.: https://...)" />
        <button id="dlBtn">Baixar</button>
      </div>
      <div class="progress" aria-hidden="true"><div id="pg"></div></div>
      <small>ASCIIâ€‘DSL: use showASCIIAnim(script). Paletas: setArchetype('atlas' | 'nova' | ...).</small>
    </section>

    <section class="row" style="justify-content:center">
      <button class="chip" id="chipClear">ðŸ§¹ Limpar</button>
      <button class="chip" id="chipPalette">ðŸŽ¨ Paleta: Atlas</button>
      <button class="chip" id="chipAsciiDemo">âœ§ ASCII Demo</button>
    </section>
    <div style="height:max(20px,var(--safe))"></div>
  </main>

  <script>
    const $=(q)=>document.querySelector(q);
    const body=document.body, ascii=$('#ascii'), logEl=$('#log'), promptEl=$('#prompt'), sendBtn=$('#send');
    const face=$('#face'), mouth=$('#mouth'), pupilL=$('#pupilL'), pupilR=$('#pupilR'), eyeL=$('#eyeL'), eyeR=$('#eyeR'), pad=$('#pad');
    const btnTTS=$('#btnTTS'), btnSave=$('#btnSave'); const urlEl=$('#url'), dlBtn=$('#dlBtn'), pg=$('#pg');
    // storage
    const cfgKey='dual_cfg', histKey='dual_hist';
    const store={ get cfg(){try{return JSON.parse(localStorage.getItem(cfgKey)||'{}')}catch(_){return{}}}, set cfg(v){localStorage.setItem(cfgKey, JSON.stringify(v))},
                  get hist(){try{return JSON.parse(localStorage.getItem(histKey)||'[]')}catch(_){return[]}}, set hist(v){localStorage.setItem(histKey, JSON.stringify(v))} }
    // toggles
    function setToggle(el,on){ el.classList.toggle('on', !!on); el.setAttribute('aria-pressed', on?'true':'false'); }
    function loadToggles(){ const {autoTTS=false, persist=true}=store.cfg; setToggle(btnTTS, autoTTS); setToggle(btnSave, persist!==false); }
    loadToggles();
    btnTTS.onclick=()=>{ const c=store.cfg; c.autoTTS=!(c.autoTTS); store.cfg=c; setToggle(btnTTS,c.autoTTS); play('tap'); };
    btnSave.onclick=()=>{ const c=store.cfg; c.persist=!(c.persist!==false); store.cfg=c; setToggle(btnSave,c.persist!==false); play('ready'); };

    // WebAudio mini sfx
    const ctx = typeof AudioContext!=='undefined' ? new AudioContext() : null;
    function tone(freq=440, dur=0.12, type='sine', vol=0.2){
      if(!ctx) return; const o=ctx.createOscillator(), g=ctx.createGain();
      o.type=type; o.frequency.value=freq; g.gain.value=vol;
      o.connect(g).connect(ctx.destination); o.start(); g.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime+dur); o.stop(ctx.currentTime+dur);
    }
    function play(name){
      if(!ctx) return;
      if(name==='tap'){ tone(660, .06, 'sine'); }
      else if(name==='ready'){ tone(880, .08, 'triangle'); setTimeout(()=>tone(1320,.08,'triangle'),70); }
      else if(name==='error'){ tone(220, .18, 'sawtooth', .15); setTimeout(()=>tone(180,.18,'sawtooth', .12),80); }
    }

    // face helpers
    const center={x:60,y:56}, maxOffset=5;
    function mouthShape(s){ const M={neutral:"M45 84q15 10 30 0", speak:"M52 86q8 -6 16 0", flat:"M45 86H75", grin:"M42 82q18 16 36 0", o:"M58 86a6 6 0 1 0 4 0", wow:"M56 84a8 8 0 1 0 8 0"}; mouth.setAttribute('d', M[s]||M.neutral); }
    function blink(){ eyeL.setAttribute('ry',2); eyeR.setAttribute('ry',2); setTimeout(()=>{eyeL.setAttribute('ry',10); eyeR.setAttribute('ry',10);},120); }
    setInterval(()=>{ if(Math.random()<0.22) blink(); },1800);
    function setMood(m){ face.className='mood'; const map={thinking:'m-thinking', speaking:'m-speaking', saved:'m-saved', error:'m-error', surprise:'m-surprise', excited:'m-excited', sleep:'m-sleep'}; if(map[m]) face.classList.add(map[m]); if(m==='thinking') mouthShape('flat'); else if(m==='speaking') mouthShape('speak'); else if(m==='saved') mouthShape('grin'); else if(m==='error') mouthShape('o'); else if(m==='surprise') mouthShape('wow'); else mouthShape('neutral'); }

    // Paletas por arquÃ©tipo
    const palettes={
      atlas:'linear-gradient(42deg,#65d,#7ef)',
      nova:'linear-gradient(42deg,#ff7edb,#7ef)',
      vitalis:'linear-gradient(42deg,#aaff88,#33ffd9)',
      pulse:'linear-gradient(42deg,#ff3cac,#784ba0)',
      artemis:'linear-gradient(42deg,#ffd36f,#ff6f91)',
      serena:'linear-gradient(42deg,#90caf9,#e3f2fd)',
      kaos:'linear-gradient(42deg,#ff8a00,#e52e71)',
      genus:'linear-gradient(42deg,#6a85b6,#bac8e0)',
      lumine:'linear-gradient(42deg,#ffe29f,#ffa99f)',
      aion:'linear-gradient(42deg,#9796f0,#fbc7d4)',
      rhea:'linear-gradient(42deg,#43e97b,#38f9d7)',
      horus:'linear-gradient(42deg,#f0f,#0ff)'
    };
    function setArchetype(name){ const g=palettes[name]||palettes.horus; body.style.setProperty('--grad', g); play('ready'); }
    $('#chipPalette').onclick=()=>{ setArchetype('atlas'); };

    // ASCII overlays + DSL
    let asciiTimer=null, asciiIndex=0;
    function showASCII(frames, duration=1600, fps=6){
      clearInterval(asciiTimer); asciiIndex=0; ascii.classList.add('show'); ascii.textContent=frames[0];
      const step=1000/Math.max(1,fps);
      asciiTimer=setInterval(()=>{ asciiIndex=(asciiIndex+1)%frames.length; ascii.textContent=frames[asciiIndex]; }, step);
      setTimeout(()=>{ ascii.classList.remove('show'); clearInterval(asciiTimer); }, duration);
    }
    // DSL: header com @fps:8 @dur:2000 e frames separados por "\n---\n"
    function showASCIIAnim(script){
      script=script.trim();
      let fps=6, dur=1600;
      const header=script.match(/^@([^\n]+)\n/);
      if(header){ const h=header[1]; script=script.slice(header[0].length); const fpsM=h.match(/fps:(\d+)/i); const durM=h.match(/dur:(\d+)/i); if(fpsM) fps=+fpsM[1]; if(durM) dur=+durM[1]; }
      const frames=script.split(/\n---\n/);
      showASCII(frames, dur, fps);
    }
    $('#chipAsciiDemo').onclick=()=>{
      const script = `@fps:8 dur:2200
( Í¡Â° ÍœÊ– Í¡Â°)â”â˜†ï¾Ÿ.*ï½¥ï½¡ï¾Ÿ
CÃ‰REBROâ€‘ORÃCULO pulsando em:
criar animaÃ§Ãµes custom
---
( Í¡Â° ÍœÊ– Í¡Â°)  â˜†ï¾Ÿ.*ï½¥ï½¡ï¾Ÿ
CÃ‰REBROâ€‘ORÃCULO pulsando em:
criar animaÃ§Ãµes custom
---
( Í¡Â° ÍœÊ– Í¡Â°)   âœ§
CÃ‰REBROâ€‘ORÃCULO pulsando em:
criar animaÃ§Ãµes custom`;
      showASCIIAnim(script);
    };

    // TTS
    function speak(text){ try{ if(!store.cfg.autoTTS) return; const u=new SpeechSynthesisUtterance(text); u.lang='pt-BR'; speechSynthesis.cancel(); speechSynthesis.speak(u);}catch(_){} }

    // Chat streaming (like before but compact)
    function addMsg(role, content){ let el=document.createElement('div'); el.className='msg '+(role==='user'?'you':'ai'); el.textContent=content; logEl.appendChild(el); logEl.scrollTop=logEl.scrollHeight; return el; }
    function pushHist(role, content){ if(store.cfg.persist!==false){ const h=store.hist; h.push({role, content}); store.hist=h.slice(-64);} }
    async function callStream(messages){
      const {apiKey, model='openrouter/auto'}=store.cfg; if(!apiKey){ setMood('error'); play('error'); alert('Cole sua OpenRouter API Key.'); return null; }
      try{
        const res=await fetch('https://openrouter.ai/api/v1/chat/completions', {method:'POST', headers:{'Content-Type':'application/json','Authorization':'Bearer '+apiKey,'HTTP-Referer':location.href,'X-Title':'Dual Nebula Pro'}, body: JSON.stringify({model, messages, temperature:0.7, stream:true})});
        if(!res.ok) throw new Error('HTTP '+res.status);
        return res.body;
      }catch(e){ setMood('error'); play('error'); return null; }
    }
    let talkTimer=null; function startTalking(){ clearInterval(talkTimer); talkTimer=setInterval(()=>{ mouthShape(Math.random()<.5?'speak':'neutral'); }, 90);} function stopTalking(){ clearInterval(talkTimer); mouthShape('neutral'); }
    async function send(){
      const q=promptEl.value.trim(); if(!q) return;
      promptEl.value=''; addMsg('user', q); pushHist('user', q); setMood('thinking'); play('tap');
      const messages=[{role:'system', content: store.cfg.system||'VocÃª Ã© a AA Dual.Infodose. Curta e Ãºtil.'},{role:'user', content:q}];
      sendBtn.disabled=true; sendBtn.textContent='â€¦';
      const stream=await callStream(messages); if(!stream){ sendBtn.disabled=false; sendBtn.textContent='Enviar'; return; }
      setMood('speaking'); startTalking();
      const out=addMsg('assistant',''); const reader=stream.getReader(); const dec=new TextDecoder(); let buf='';
      while(true){ const {value, done}=await reader.read(); if(done) break; buf+=dec.decode(value,{stream:true}); const parts=buf.split("\n\n"); for(let i=0;i<parts.length-1;i++){ const ch=parts[i]; if(ch.startsWith("data: ")){ const s=ch.slice(6); if(s==="[DONE]") continue; try{ const d=JSON.parse(s); const t=d.choices?.[0]?.delta?.content||""; if(t){ out.textContent+=t; logEl.scrollTop=logEl.scrollHeight; } }catch(_){} } } buf=parts[parts.length-1]; }
      stopTalking(); setMood('saved'); play('ready'); sendBtn.disabled=false; sendBtn.textContent='Enviar'; pushHist('assistant', out.textContent); speak(out.textContent);
    }
    sendBtn.onclick=send; promptEl.addEventListener('keydown', e=>{ if(e.key==='Enter'){ e.preventDefault(); send(); }});

    // Download real com olhos orbitando
    let orbitTimer=null, theta=0;
    function startOrbit(){ clearInterval(orbitTimer); theta=0; orbitTimer=setInterval(()=>{ theta+=0.18; const r=3.5; const dx=r*Math.cos(theta), dy=r*Math.sin(theta); pupilL.setAttribute('cx',46+dx); pupilL.setAttribute('cy',56+dy); pupilR.setAttribute('cx',74-dx); pupilR.setAttribute('cy',56-dy); }, 16); }
    function stopOrbit(){ clearInterval(orbitTimer); pupilL.setAttribute('cx',46); pupilL.setAttribute('cy',56); pupilR.setAttribute('cx',74); pupilR.setAttribute('cy',56); }
    async function downloadFile(url){
      if(!url) return;
      try{
        setMood('thinking'); startOrbit(); play('tap');
        showASCIIAnim(`@fps:8 dur:2400
carregando docsâ€¦

  âŠ™   âŠ™
    â€”    
---
carregando docsâ€¦

   âŠ™ âŠ™ 
   â€”  â€” 
---
carregando docsâ€¦

    âŠ™âŠ™  
     â€”â€” `);
        const res=await fetch(url); if(!res.ok) throw new Error('HTTP '+res.status);
        const reader=res.body.getReader(); const len=+res.headers.get('Content-Length')||0; let received=0;
        pg.style.width='0%';
        const chunks=[]; while(true){ const {done, value}=await reader.read(); if(done) break; chunks.push(value); received+=value.length; if(len){ pg.style.width=((received/len)*100).toFixed(1)+'%'; } }
        stopOrbit(); setMood('saved'); play('ready'); pg.style.width='100%';
        // opcional: baixar local
        const blob=new Blob(chunks); const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='download.bin'; a.click(); URL.revokeObjectURL(a.href);
      }catch(e){ stopOrbit(); setMood('error'); play('error'); console.error(e); }
    }
    dlBtn.onclick=()=> downloadFile(urlEl.value.trim());

    // expose
    window.setArchetype=setArchetype; window.showASCIIAnim=showASCIIAnim;
  </script>
</body>
</html>