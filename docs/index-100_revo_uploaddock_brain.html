<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
  <title>Infodose Hub ‚Äî Upload + Brain Menu</title>
  <meta name="theme-color" content="#0b0b0b">
  <style>
    :root{
      --fg:#fff; --acc:#E7C65A; --stroke:rgba(255,235,180,.30); --stroke2:rgba(255,235,180,.16);
      --dock-space:84px; --blur:22px;
    }
    html,body{height:100%;margin:0}
    body{
      color:var(--fg); font-family:ui-rounded,system-ui,-apple-system,Inter,Segoe UI,Roboto,Arial;
      background:linear-gradient(42deg,#f0f,#0ff); -webkit-tap-highlight-color:transparent;
      min-height:100vh;
    }
    .header{position:sticky;top:0;z-index:100;backdrop-filter:blur(var(--blur)) saturate(150%);
      background:rgba(0,0,0,.45);border-bottom:1px solid var(--stroke);padding-top:env(safe-area-inset-top)}
    .inner{max-width:980px;margin:0 auto;padding:14px;display:flex;gap:14px;align-items:center}
    .logo{width:46px;height:46px;border-radius:50%;display:inline-grid;place-items:center;position:relative;background:rgba(0,0,0,.25);cursor:pointer}
    .ring{position:absolute;inset:0;border:2px solid var(--acc);border-radius:50%;animation:spin 6s linear infinite}
    .bar{position:absolute;left:50%;top:50%;width:60%;height:2px;background:var(--acc);transform:translate(-50%,-50%);border-radius:999px;animation:breathe 2.4s ease-in-out infinite}
    @keyframes spin{to{transform:rotate(360deg)}}
    @keyframes breathe{0%,100%{opacity:.8}50%{opacity:1}}
    h1{font-size:1.2rem;margin:.12rem 0 0;font-weight:800}
    .kicker{font-size:.72rem;letter-spacing:.16em;color:#e0e0e0;text-transform:uppercase}
    .grid{max-width:980px;margin:18px auto 22px;display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:16px;padding:0 14px;
      padding-bottom:calc(var(--dock-space) + env(safe-area-inset-bottom) + 12px)}
    @media(max-width:560px){.grid{grid-template-columns:1fr}}
    .card{background:rgba(0,0,0,.3);border:1px solid var(--stroke2);border-radius:20px;padding:16px;display:flex;gap:14px;align-items:center;box-shadow:0 6px 18px rgba(0,0,0,.45)}
    .icon{width:58px;height:58px;border-radius:16px;display:grid;place-items:center;overflow:hidden;background:#0f1320;border:1px solid var(--stroke2)}
    .btn{appearance:none;border:1px solid var(--stroke2);cursor:pointer;background:linear-gradient(42deg,#f0f,#0ff);color:#fff;padding:.72rem 1.05rem;border-radius:999px;font-weight:700}
    .dock{position:fixed;left:0;right:0;bottom:0;z-index:1000}
    .dock-inner{max-width:980px;margin:0 auto;padding:8px 10px calc(8px + env(safe-area-inset-bottom));
      display:flex;gap:8px;justify-content:space-between;align-items:center;
      backdrop-filter:blur(18px) saturate(140%);background:rgba(0,0,0,.45);border-top:1px solid var(--stroke);
      box-shadow:0 -10px 30px rgba(0,0,0,.45)}
    .dbtn{appearance:none;border:1px solid var(--stroke);background:linear-gradient(42deg,#f0f,#0ff);color:#fff;padding:.64rem .9rem;border-radius:12px;font-weight:700}
    .dbtn.small{padding:.5rem .7rem;font-size:.9rem}
    .viewer-iframe{display:block;width:100%;height:100%;border:0;outline:0;background:#0b0b0b;transform:translateZ(0);-webkit-overflow-scrolling:touch}
  </style>
</head>
<body>
<header class="header" id="mainHeader">
  <div class="inner">
    <span class="logo" id="logo" title="Abrir menu / Brain">
      <span class="ring"></span><span class="bar"></span>
    </span>
    <div style="flex:1">
      <div class="kicker">Infodose ‚Ä¢ Hub Principal</div>
      <h1>Infodose Hub ‚Äî Upload + Brain Menu</h1>
    </div>
    <nav><button class="btn" id="btnInstall" type="button">‚¨áÔ∏è Instalar</button></nav>
  </div>
</header>
<main class="grid" id="cards" aria-live="polite"></main>

<section id="revo" style="position:fixed;left:0;right:0;top:72px;bottom:calc(var(--dock-space) + env(safe-area-inset-bottom));z-index:900;display:none;background:rgba(0,0,0,.18);border-top:1px solid var(--stroke)">
  <div style="display:flex;gap:8px;align-items:center;justify-content:space-between;padding:8px 10px;background:rgba(0,0,0,.55);border-bottom:1px solid var(--stroke)">
    <div id="revoTitle" style="font-weight:800">Revo</div>
    <div>
      <button class="dbtn small" id="revoBack" type="button">‚Üê Hub</button>
      <button class="dbtn small" id="revoMin" type="button">‚Äî Minimizar</button>
      <a class="dbtn small" id="revoOpen" target="_blank" rel="noopener">‚Üó Abrir</a>
    </div>
  </div>
  <iframe id="revoFrame" class="viewer-iframe"></iframe>
</section>
<button class="dbtn" id="btnReopen" style="position:fixed;right:12px;bottom:calc(var(--dock-space) + env(safe-area-inset-bottom) + 12px);z-index:950;display:none">‚óê Reabrir App</button>

<div class="dock" role="navigation" aria-label="Dock">
  <div class="dock-inner">
    <div style="display:flex;gap:8px">
      <button class="dbtn" id="dockHome" type="button">Home</button>
      <!-- Infodose replaced by Upload -->
      <input id="localHtmlInput" type="file" accept=".html,.htm,text/html" hidden>
      <button class="dbtn" id="btnLocalOpen" type="button">üìÅ HTML Local</button>
      <button class="dbtn" id="dockInstall" type="button">Instalar</button>
    </div>
    <div class="group">
      <span class="badge" id="brainNameBadge">üë§ sem-nome</span>
      <span class="badge" id="brainSKBadge">üîë sem-chave</span>
    </div>
  </div>
</div>

<style>
.sheet{position:fixed;inset:auto 0 0 0;z-index:1200;display:none;max-height:88vh;background:rgba(0,0,0,.8);
  backdrop-filter:blur(16px) saturate(140%);border-top:1px solid var(--stroke);padding:14px 16px calc(14px + env(safe-area-inset-bottom));}
.sheet.active{display:block}
.sheet h2{margin:0 0 8px;font-size:1.1rem}
.row{display:grid;grid-template-columns:1fr;gap:10px;margin:10px 0}
.input, .textarea{width:100%;padding:.7rem .9rem;border-radius:12px;border:1px solid var(--stroke2);background:rgba(255,255,255,.06);color:#fff}
.textarea{min-height:120px}
.group{display:flex;gap:8px;flex-wrap:wrap}
.badge{padding:.3rem .6rem;border:1px solid var(--stroke2);border-radius:999px}
</style>
<div class="sheet" id="brainSheet" role="dialog" aria-modal="true" aria-labelledby="brainTitle">
  <h2 id="brainTitle">Dual Brain ‚Äî Perfil & Chaves</h2>
  <div class="row">
    <label>Nome do usu√°rio</label>
    <input id="br_name" class="input" placeholder="Seu nome">
  </div>
  <div class="row">
    <label>OpenRouter SK (guardada localmente)</label>
    <input id="br_sk" class="input" placeholder="sk-or-v1-...">
  </div>
  <div class="row">
    <label>Background (URL) ‚Äî opcional</label>
    <input id="br_bg_url" class="input" placeholder="https://.../fundo.png">
  </div>
  <div class="row">
    <label>Background (arquivo local) ‚Äî opcional</label>
    <input id="br_bg_file" type="file" accept="image/*" class="input">
  </div>
  <div class="row">
    <div class="group">
      <button class="dbtn" id="br_save" type="button">üíæ Salvar</button>
      <button class="dbtn" id="br_export" type="button">‚¨áÔ∏è Exportar</button>
      <input id="br_import_file" type="file" accept="application/json" hidden>
      <button class="dbtn" id="br_import" type="button">‚¨ÜÔ∏è Importar</button>
      <button class="dbtn" id="br_close" type="button">‚úñ Fechar</button>
    </div>
  </div>
  <div class="row">
    <label>Logs</label>
    <textarea id="br_logs" class="textarea" readonly></textarea>
  </div>
</div>

<script>
const $ = (q,root=document)=>root.querySelector(q);
let currentObjectURL=null, bgObjectURL=null;
function fitTop(){ const header=$('#mainHeader'); const revo=$('#revo'); revo.style.top = header.getBoundingClientRect().height+'px'; }
window.addEventListener('resize',fitTop); window.addEventListener('orientationchange',fitTop);

function openInRevo(url,title='App'){ fitTop(); const v=$('#revo'); const t=$('#revoTitle'); const f=$('#revoFrame'); const o=$('#revoOpen');
  t.textContent=title; f.src=url; o.href=url; v.style.display='block'; document.body.style.overflow='hidden'; }
function closeRevo(){ const v=$('#revo'); const f=$('#revoFrame'); v.style.display='none'; f.src='about:blank'; document.body.style.overflow='';
  if(currentObjectURL){URL.revokeObjectURL(currentObjectURL);currentObjectURL=null} }
function minRevo(){ $('#revo').style.display='none'; $('#btnReopen').style.display='inline-block'; document.body.style.overflow=''; }
$('#revoBack').onclick=closeRevo; $('#revoMin').onclick=minRevo; $('#btnReopen').onclick=()=>{ $('#revo').style.display='block'; $('#btnReopen').style.display='none'; document.body.style.overflow='hidden'; };

// Dock actions
$('#dockHome').onclick=()=>{ closeRevo(); window.scrollTo({top:0,behavior:'smooth'}); };
$('#dockInstall').onclick=()=>$('#btnInstall').click();

// Local upload
const inputLocal=$('#localHtmlInput'); $('#btnLocalOpen').onclick=()=>inputLocal.click();
inputLocal.addEventListener('change',(ev)=>{ const f=ev.target.files&&ev.target.files[0]; if(!f)return;
  if(currentObjectURL)URL.revokeObjectURL(currentObjectURL); currentObjectURL=URL.createObjectURL(f);
  openInRevo(currentObjectURL, f.name||'HTML Local'); inputLocal.value=''; });

// Brain menu via logo
const brainKey='dual.brain';
function readBrain(){ try{ return JSON.parse(localStorage.getItem(brainKey)||'{}'); }catch{ return {}; } }
function writeBrain(obj){ localStorage.setItem(brainKey, JSON.stringify(obj)); }
function log(msg){ const l=$('#br_logs'); l.value = (new Date().toLocaleString())+' ‚Äî '+msg+'\n' + l.value; }
function applyBadges(b){ $('#brainNameBadge').textContent = 'üë§ '+(b.name||'sem-nome'); $('#brainSKBadge').textContent = 'üîë '+(b.sk?('‚Ä¢‚Ä¢‚Ä¢'+b.sk.slice(-4)):'sem-chave'); }
function applyBackground(b){
  if(bgObjectURL){ URL.revokeObjectURL(bgObjectURL); bgObjectURL=null; }
  if(b.bgFile){ document.body.style.backgroundImage = 'url("'+b.bgFile+'")'; document.body.style.backgroundSize='cover'; document.body.style.backgroundAttachment='fixed'; }
  else if(b.bg){ document.body.style.backgroundImage='url("'+b.bg+'")'; document.body.style.backgroundSize='cover'; document.body.style.backgroundAttachment='fixed'; }
  else { document.body.style.backgroundImage=''; }
}
function openBrain(){
  const b=readBrain();
  $('#br_name').value = b.name||'';
  $('#br_sk').value   = b.sk||'';
  $('#br_bg_url').value = b.bg||'';
  $('#brainSheet').classList.add('active');
  log('abriu-sheet');
}
function closeBrain(){ $('#brainSheet').classList.remove('active'); }
$('#logo').addEventListener('click', openBrain);
$('#br_close').addEventListener('click', closeBrain);
$('#br_save').addEventListener('click', ()=>{
  const name=$('#br_name').value.trim(); const sk=$('#br_sk').value.trim(); const bg=$('#br_bg_url').value.trim();
  const b=readBrain(); b.name=name; b.sk=sk; b.bg=bg;
  const f=$('#br_bg_file').files && $('#br_bg_file').files[0];
  if(f){ if(bgObjectURL)URL.revokeObjectURL(bgObjectURL); bgObjectURL=URL.createObjectURL(f); b.bgFile=bgObjectURL; }
  writeBrain(b); applyBadges(b); applyBackground(b); log('salvou-perfil'); alert('Salvo!');
});
$('#br_export').addEventListener('click', ()=>{
  const blob = new Blob([localStorage.getItem(brainKey)||'{}'], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a=document.createElement('a'); a.href=url; a.download='dual.brain.json'; a.click(); setTimeout(()=>URL.revokeObjectURL(url),500);
  log('exportou-brain');
});
$('#br_import').addEventListener('click', ()=>$('#br_import_file').click());
$('#br_import_file').addEventListener('change', async (ev)=>{
  const file=ev.target.files && ev.target.files[0]; if(!file)return;
  const txt = await file.text(); try{ const obj=JSON.parse(txt); writeBrain(obj); applyBadges(obj); applyBackground(obj); log('importou-brain'); alert('Importado!'); }catch{ alert('JSON inv√°lido'); }
  ev.target.value='';
});

// init
const b=readBrain(); applyBadges(b); applyBackground(b); fitTop();
</script>

<script>
const $ = (q,root=document)=>root.querySelector(q);

async function loadApps(){
  try{
    const res  = await fetch('./apps/apps.json', {cache:'no-store'});
    const data = await res.json();
    const root = $('#cards');
    root.innerHTML='';
    (data.apps || []).forEach(app=>{
      const card = document.createElement('div');
      card.className='card';
      const icon = app.icon || 'icons/icon-192.png';
      const title= app.title || app.key || 'App';
      const desc = app.desc || '';
      const url  = app.url;
      card.innerHTML = `
      <div class="icon"><img src="${icon}" alt="" style="width:100%;height:100%;object-fit:cover;border-radius:12px"/></div>
      <div style="flex:1">
        <div class="title" style="font-weight:800">${title}</div>
        <div class="muted" style="opacity:.9">${desc}</div>
        <div class="row" style="margin-top:8px">
          <button class="btn" type="button" ${url?`onclick="openInRevo('${encodeURI(url)}','${(title+'').replace(/'/g,"\\'")}')"`:'disabled'}>Abrir</button>
        </div>
      </div>`;
      root.appendChild(card);
    });
  }catch(e){
    $('#cards').innerHTML = '<div class="card"><div class="icon">‚ö†Ô∏è</div><div><div style="font-weight:800">Falha ao carregar</div><div class="muted">apps/apps.json n√£o encontrado.</div></div></div>';
  }
}
loadApps();

// PWA install
if('serviceWorker' in navigator){
  window.addEventListener('load',()=>navigator.serviceWorker.register('./sw.js').catch(()=>{}));
}
let deferredPrompt=null;
window.addEventListener('beforeinstallprompt',e=>{e.preventDefault();deferredPrompt=e;});
async function doInstall(){ if(deferredPrompt){ deferredPrompt.prompt(); await deferredPrompt.userChoice; deferredPrompt=null; } else { alert('Use ‚ÄúAdicionar √† Tela de In√≠cio‚Äù.'); } }
$('#btnInstall').addEventListener('click',doInstall);
</script>
</body></html>