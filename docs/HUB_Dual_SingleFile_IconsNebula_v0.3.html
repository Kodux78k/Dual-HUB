<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
<title>HUB DUAL — Nebula Pro • UNO Dual Trinity (Single-File v0.3)</title>
<meta name="color-scheme" content="dark"/>
<style>
:root{
  --bg:#090b12; --txt:#eef2ff; --mut:#9fb0d6;
  --g1:#ff00ff; --g2:#00e1ff;
  --glass: rgba(16,18,30,.66);
  --glass-strong: rgba(14,16,28,.82);
  --br:22px; --br-lg:26px;
  --bd:1px solid rgba(255,255,255,.10);
  --bd2:1px solid rgba(255,255,255,.14);
  --shadow:0 14px 40px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.06);
  --nav-h:64px; --dock-h:70px;
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0; color:var(--txt);
  font:14.5px/1.45 Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Helvetica, Arial;
  background: linear-gradient(42deg, var(--g1), var(--g2)) fixed;
  overflow-x:hidden;
}
.atmo{position:fixed; inset:0; pointer-events:none;
  background:
    radial-gradient(1200px 800px at 50% -8%, rgba(255,255,255,.14), transparent 60%),
    radial-gradient(900px 700px at 100% 110%, rgba(255,255,255,.10), transparent 55%);
  mix-blend-mode:screen;
}
.shell{max-width:440px; margin:0 auto; min-height:100dvh;
  padding-top:calc(var(--nav-h) + 12px);
  padding-bottom:calc(var(--dock-h) + 16px);
}
.header{position:fixed; inset:0 0 auto 0; height:var(--nav-h); display:flex; justify-content:center; align-items:center; z-index:40; padding:12px;}
.header .bar{width:100%; max-width:460px; display:grid; grid-template-columns:40px 1fr 40px; gap:10px; align-items:center;
  background:var(--glass); backdrop-filter: blur(16px) saturate(110%); border:var(--bd);
  border-radius:var(--br-lg); padding:10px 12px; box-shadow:var(--shadow);
}
.btn{width:40px; height:40px; border-radius:14px; display:grid; place-items:center; border:var(--bd);
  background:rgba(255,255,255,.06); box-shadow: inset 0 0 0 1px rgba(255,255,255,.02); cursor:pointer; transition:transform .12s ease, background .12s ease;}
.btn:active{transform:translateY(1px) scale(.98)}
.btn:hover{background:rgba(255,255,255,.09)}
.title{text-align:center}
.title h1{margin:0; font-size:20px; letter-spacing:.6px; font-weight:900; text-transform:uppercase}
.title small{display:block; margin-top:2px; color:var(--mut); font-weight:700; letter-spacing:.4px}
.menu{position:absolute; right:12px; top:calc(100% + 6px); width:min(92vw, 360px); display:none; z-index:60;
  background:var(--glass-strong); border:var(--bd2); border-radius:var(--br-lg); box-shadow:var(--shadow); padding:10px;}
.menu.open{display:block; animation:pop .14s ease-out}
@keyframes pop{from{opacity:0; transform:translateY(-6px)} to{opacity:1}}
.menu h3{margin:8px 10px 6px; font-size:16px}
.row{display:grid; grid-template-columns:28px 1fr auto; align-items:center; gap:10px;
  padding:10px 12px; border-radius:16px; background:rgba(255,255,255,.04); border:var(--bd); }
.row .pill{font-size:12px; padding:6px 10px; border-radius:999px; background:rgba(255,255,255,.06); border:var(--bd); color:var(--mut)}
section{display:none; padding:12px;}
section.active{display:block}
.section-title{margin:2px 4px 10px; font-weight:900; letter-spacing:.4px; text-transform:uppercase; opacity:.85}
.grid-quick{display:grid; grid-template-columns:repeat(4,1fr); gap:10px}
.icon-tile{display:grid; place-items:center; aspect-ratio:1/1; border-radius:18px; background:rgba(9,10,16,.4);
  border:var(--bd); box-shadow:var(--shadow); overflow:hidden}
.icon-tile svg{width:28px; height:28px; opacity:.95}
.grid-apps{display:grid; grid-template-columns:repeat(4,1fr); gap:14px; justify-items:center}
.app-card{width:72px; display:grid; grid-template-rows:56px auto; gap:8px; text-align:center}
.app-card .ico{display:grid; place-items:center; width:56px; height:56px; border-radius:18px; background:rgba(255,255,255,.08); border:var(--bd); box-shadow:var(--shadow)}
.app-card .ico svg{width:26px; height:26px}
.app-card small{color:var(--mut); font-weight:700}
.stack{display:flex; flex-direction:column; gap:12px}
.card{background:var(--glass); border:var(--bd); border-radius:var(--br); box-shadow:var(--shadow); padding:14px; min-height:120px; position:relative}
.card .head{display:grid; grid-template-columns:1fr auto auto auto; gap:8px; align-items:center}
.card h2{margin:0; font-weight:800; font-size:20px}
.inline .btn{width:36px; height:36px; border-radius:12px}
.chip{font-size:12px; padding:6px 10px; border-radius:999px; background:rgba(255,255,255,.06); border:var(--bd); color:var(--mut)}
.dock{position:fixed; left:0; right:0; bottom:0; height:var(--dock-h); display:flex; justify-content:center; z-index:40; padding:10px 14px;}
.dock .bar{width:100%; max-width:460px; display:grid; grid-template-columns:repeat(3,1fr); gap:12px; background:var(--glass);
  border:var(--bd); border-radius:22px; padding:10px; box-shadow:var(--shadow)}
.tab{display:grid; grid-template-columns:36px 1fr; align-items:center; gap:10px; height:50px; border-radius:14px; border:var(--bd);
  background:rgba(255,255,255,.03); padding:6px 10px; font-weight:800}
.tab.active{background:rgba(255,255,255,.09)}
.tab .btn{width:36px; height:36px}
.sr{position:absolute; width:1px; height:1px; overflow:hidden; clip:rect(0 0 0 0)}
</style>
</head>
<body>
<div class="atmo" aria-hidden="true"></div>

<svg xmlns="http://www.w3.org/2000/svg" style="display:none">
  <symbol id="hub_chat" viewBox="0 0 24 24"><path fill="currentColor" d="M21 15a4 4 0 0 1-4 4H8l-5 5V5a4 4 0 0 1 4-4h10a4 4 0 0 1 4 4z"/></symbol>
  <symbol id="hub_apps" viewBox="0 0 24 24"><rect x="3" y="3" width="7" height="7" rx="2" fill="currentColor"/><rect x="14" y="3" width="7" height="7" rx="2" fill="currentColor"/><rect x="3" y="14" width="7" height="7" rx="2" fill="currentColor"/><rect x="14" y="14" width="7" height="7" rx="2" fill="currentColor"/></symbol>
  <symbol id="hub_download" viewBox="0 0 24 24"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" stroke="currentColor" stroke-width="2" fill="none"/><path d="M7 10l5 5 5-5" stroke="currentColor" stroke-width="2" fill="none"/><path d="M12 15V3" stroke="currentColor" stroke-width="2" fill="none"/></symbol>
  <symbol id="hub_config" viewBox="0 0 24 24"><circle cx="12" cy="12" r="3" fill="currentColor"/><path d="M4 12h2m12 0h2M6.2 6.2l1.4 1.4M16.4 16.4l1.4 1.4M6.2 17.8l1.4-1.4M16.4 7.6l1.4-1.4" stroke="currentColor" stroke-width="2"/></symbol>
  <symbol id="hub_perfil" viewBox="0 0 24 24"><circle cx="12" cy="7" r="4" fill="currentColor"/><path d="M4 21a8 8 0 1 1 16 0" stroke="currentColor" stroke-width="2" fill="none"/></symbol>
  <symbol id="hub_lightning" viewBox="0 0 24 24"><path d="M13 2L3 14h7l-1 8 10-12h-7z" fill="currentColor"/></symbol>
  <symbol id="hub_memoria" viewBox="0 0 24 24"><rect x="2" y="6" width="20" height="12" rx="2" fill="currentColor"/><rect x="6" y="9" width="3" height="3" fill="#090b12"/><rect x="11" y="9" width="3" height="3" fill="#090b12"/><rect x="16" y="9" width="3" height="3" fill="#090b12"/></symbol>
</svg>

<header class="header">
  <div class="bar">
    <button class="btn" id="btnBack" title="Voltar" aria-label="Voltar">
      <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <polyline points="15 18 9 12 15 6"></polyline>
      </svg>
    </button>
    <div class="title">
      <h1>HUB DUAL</h1>
      <small>UNO Dual Trinity</small>
    </div>
    <button class="btn" id="btnAvatar" aria-haspopup="menu" aria-expanded="false" aria-controls="brainMenu" title="Dual Brain">
      <svg width="22" height="22" viewBox="0 0 24 24"><use href="#hub_perfil"/></svg>
    </button>

    <nav id="brainMenu" class="menu" role="menu" aria-label="Brain">
      <h3>Brain</h3>
      <div class="row">
        <svg width="22" height="22" viewBox="0 0 24 24"><use href="#hub_download"/></svg>
        <div><strong>Download</strong><div class="sr">Exportar backup</div></div>
        <button class="pill" onclick="dual.brain.exportBackup()">Exportar</button>
      </div>
      <div class="row">
        <svg width="22" height="22" viewBox="0 0 24 24"><use href="#hub_config"/></svg>
        <div><strong>SK Key</strong><div class="sr">Chave base</div></div>
        <button class="pill" onclick="dual.brain.promptKey()">Salvar</button>
      </div>
      <div class="row">
        <svg width="22" height="22" viewBox="0 0 24 24"><use href="#hub_chat"/></svg>
        <div><strong>TTS Voices</strong><div class="sr">voz</div></div>
        <button class="pill" onclick="dual.bus.emit('brain:tts:test',{voice:dual.settings.tts.voice})">Testar</button>
      </div>
    </nav>
  </div>
</header>

<main class="shell">
  <section id="home" class="active">
    <div class="section-title">Home</div>
    <div class="grid-quick">
      <div class="icon-tile" title="Apps" onclick="go('#/apps')"><svg viewBox="0 0 24 24"><use href="#hub_apps"/></svg></div>
      <div class="icon-tile" title="Stack" onclick="go('#/stack')"><svg viewBox="0 0 24 24"><path d="M12 2l9 4.5-9 4.5L3 6.5 12 2z" fill="currentColor"/><path d="M3 13l9 4.5 9-4.5" fill="none" stroke="currentColor" stroke-width="2"/></svg></div>
      <div class="icon-tile" title="Brain" onclick="toggleMenu(true)"><svg viewBox="0 0 24 24"><use href="#hub_perfil"/></svg></div>
      <div class="icon-tile" title="Minimize"><svg viewBox="0 0 24 24"><path d="M5 12h14" stroke="currentColor" stroke-width="2"/></svg></div>
    </div>
  </section>

  <section id="apps">
    <div class="section-title">Apps</div>
    <div id="appsGrid" class="grid-apps" aria-live="polite"></div>
  </section>

  <section id="stack">
    <div class="section-title">Stack</div>
    <div class="stack">
      <div class="card">
        <div class="head">
          <h2>App 1</h2>
          <div class="inline">
            <button class="btn" title="Minimizar"><svg width="18" height="18" viewBox="0 0 24 24"><path d="M5 12h14" stroke="currentColor" stroke-width="2"/></svg></button>
            <button class="btn" title="Recarregar"><svg width="18" height="18" viewBox="0 0 24 24"><path d="M23 4v6h-6M1 20v-6h6" stroke="currentColor" stroke-width="2" fill="none"/><path d="M3.5 9A9 9 0 0 1 17.6 5.6L23 10M1 14l5.4 4.4A9 9 0 0 0 20.5 15" stroke="currentColor" stroke-width="2" fill="none"/></svg></button>
            <button class="btn" title="Fechar"><svg width="18" height="18" viewBox="0 0 24 24"><path d="M6 6l12 12M18 6 6 18" stroke="currentColor" stroke-width="2"/></svg></button>
          </div>
        </div>
      </div>
      <div class="card">
        <div class="head">
          <h2>App 2</h2>
          <div class="inline">
            <button class="btn" title="Minimizar"><svg width="18" height="18" viewBox="0 0 24 24"><path d="M5 12h14" stroke="currentColor" stroke-width="2"/></svg></button>
            <button class="btn" title="Mais"><svg width="18" height="18" viewBox="0 0 24 24"><circle cx="12" cy="12" r="1.7" fill="currentColor"/><circle cx="5" cy="12" r="1.7" fill="currentColor"/><circle cx="19" cy="12" r="1.7" fill="currentColor"/></svg></button>
            <button class="btn" title="Fechar"><svg width="18" height="18" viewBox="0 0 24 24"><path d="M6 6l12 12M18 6 6 18" stroke="currentColor" stroke-width="2"/></svg></button>
          </div>
        </div>
        <div class="chip" style="position:absolute; right:14px; bottom:14px;">Minimized</div>
      </div>
    </div>
  </section>
</main>

<nav class="dock" aria-label="Tabs">
  <div class="bar">
    <button class="tab active" id="tabHome" onclick="go('#/home')">
      <span class="btn"><svg width="20" height="20" viewBox="0 0 24 24"><path d="M3 12l9-9 9 9" stroke="currentColor" stroke-width="2" fill="none"/><path d="M9 21V9h6v12" stroke="currentColor" stroke-width="2" fill="none"/></svg></span>
      <span>Home</span>
    </button>
    <button class="tab" id="tabApps" onclick="go('#/apps')">
      <span class="btn"><svg width="20" height="20" viewBox="0 0 24 24"><use href="#hub_apps"/></svg></span>
      <span>Apps</span>
    </button>
    <button class="tab" id="tabStack" onclick="go('#/stack')">
      <span class="btn"><svg width="20" height="20" viewBox="0 0 24 24"><path d="M12 2l9 4.5-9 4.5L3 6.5 12 2z" fill="currentColor"/><path d="M3 13l9 4.5 9-4.5" stroke="currentColor" stroke-width="2" fill="none"/></svg></span>
      <span>Stack</span>
    </button>
  </div>
</nav>

<script>
window.dual = {
  settings: { tts: { voice: "Kodux Dual" } },
  bus: { emit:(t,d)=>window.dispatchEvent(new CustomEvent(t,{detail:d})), on:(t,f)=>window.addEventListener(t,f) },
  brain: {
    nsKeys:"dual.keys", nsProfile:"dual.profile", nsApps:"dual.apps",
    get key(){ try{ return JSON.parse(localStorage.getItem(this.nsKeys)||"{}").openrouter || "" }catch{ return "" } },
    set key(v){ const o=JSON.parse(localStorage.getItem(this.nsKeys)||"{}"); o.openrouter=v; localStorage.setItem(this.nsKeys,JSON.stringify(o)); dual.bus.emit("brain:auth:changed",{hasKey:!!v}); },
    promptKey(){ const k=prompt("Cole sua SK (salva localmente, usada por todos os apps)"); if(k){ this.key=k; alert("Chave salva local."); } },
    exportBackup(){
      const backup={ when:new Date().toISOString(),
        [this.nsKeys]:JSON.parse(localStorage.getItem(this.nsKeys)||"{}"),
        [this.nsProfile]:JSON.parse(localStorage.getItem(this.nsProfile)||"{}"),
        [this.nsApps]:JSON.parse(localStorage.getItem(this.nsApps)||"{}")};
      const blob=new Blob([JSON.stringify(backup,null,2)],{type:"application/json"});
      const a=Object.assign(document.createElement("a"),{href:URL.createObjectURL(blob),download:"dual.backup.json"});
      a.click(); URL.revokeObjectURL(a.href);
    },
    clearLogs(){ console.clear(); }
  }
};

const $=s=>document.querySelector(s);
const sections={home:$("#home"),apps:$("#apps"),stack:$("#stack")};
const tabs={home:$("#tabHome"),apps:$("#tabApps"),stack:$("#tabStack")};
function go(hash){ location.hash=hash; route(); }
function route(){
  const r=(location.hash||"#/home").replace("#/","");
  Object.values(sections).forEach(el=>el.classList.remove("active"));
  if(sections[r]) sections[r].classList.add("active");
  Object.values(tabs).forEach(el=>el.classList.remove("active"));
  if(tabs[r]) tabs[r].classList.add("active");
  toggleMenu(false);
}
window.addEventListener("hashchange", route); route();
const avatar=$("#btnAvatar"), brainMenu=$("#brainMenu");
function toggleMenu(force){ const open=(typeof force==="boolean")?force:!brainMenu.classList.contains("open"); brainMenu.classList.toggle("open",open); avatar.setAttribute("aria-expanded",open); }
avatar.addEventListener("click",()=>toggleMenu());
document.addEventListener("click",(e)=>{ if(!brainMenu.contains(e.target)&&e.target!==avatar&&!avatar.contains(e.target)) toggleMenu(false); });

async function loadApps(){
  const grid=$("#appsGrid"); grid.innerHTML="";
  let list;
  try{
    const res=await fetch("apps/apps.json",{cache:"no-store"});
    if(!res.ok) throw 0; list=await res.json();
  }catch{
    list=[
      {"id":"chat","name":"Chat","icon":"hub_chat.svg","route":"#/chat","group":"Core","favorite":true},
      {"id":"editor","name":"Editor","icon":"hub_config.svg","route":"#/editor","group":"Core"},
      {"id":"books","name":"Books","icon":"hub_memoria.svg","route":"#/books","group":"Media"},
      {"id":"koblox","name":"KOBLOX","icon":"hub_lightning.svg","route":"#/koblox","group":"Media","favorite":true}
    ];
  }
  for(const app of list){
    const card=document.createElement("div"); card.className="app-card";
    const ico=document.createElement("div"); ico.className="ico";
    const url=`icons/others/${app.icon||"hub_apps.svg"}`;
    try{
      const raw = await fetch(url,{cache:"no-store"}).then(r=>{ if(!r.ok) throw 0; return r.text(); });
      ico.innerHTML = sanitizeSvg(raw);
    }catch{
      ico.innerHTML = `<svg viewBox="0 0 24 24"><use href="#${(app.icon||'hub_apps').replace('.svg','')}" /></svg>`;
    }
    const label=document.createElement("small"); label.textContent=app.name||app.id;
    card.appendChild(ico); card.appendChild(label); grid.appendChild(card);
  }
}
loadApps();

const SYMBOLS=["hub_chat","hub_apps","hub_config","hub_download","hub_perfil","hub_lightning","hub_memoria"];
(async function overrideSprite(){
  for(const id of SYMBOLS){
    const url=`icons/others/${id}.svg`;
    try{
      const raw = await fetch(url,{cache:"no-store"}).then(r=>{ if(!r.ok) throw 0; return r.text(); });
      const sym = document.querySelector(`symbol#${id}`);
      if(sym){ sym.innerHTML = extractPaths(raw); }
    }catch{}
  }
})();

function sanitizeSvg(txt){
  const cleaned = txt.replace(/<\?xml[^>]*>/gi,'').replace(/<!DOCTYPE[^>]*>/gi,'').trim();
  const inner = cleaned.replace(/^[\s\S]*?<svg[^>]*>/i,'').replace(/<\/svg>[^]*$/i,'');
  return `<svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor">${inner}</svg>`;
}
function extractPaths(txt){
  const cleaned = txt.replace(/<\?xml[^>]*>/gi,'').replace(/<!DOCTYPE[^>]*>/gi,'').trim();
  return cleaned.replace(/^[\s\S]*?<svg[^>]*>/i,'').replace(/<\/svg>[^]*$/i,'');
}
</script>
</body>
</html>
