<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
  <title>DUAL.InfodoseüîòHUB</title>
  <link rel="manifest" href="manifest.webmanifest">
  <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon-180.png">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="theme-color" content="#0b0b0b" id="metaThemeColor">
  <link rel="apple-touch-startup-image" href="splash-1242x2688.png"
        media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)">
  <style>
    :root{
      --bg:#0b0b0b;
      --fg:#fff;
      --muted:#b9c7cf;
      --acc:#E7C65A;
      --stroke:rgba(255,235,180,.20);
      --stroke-soft:rgba(255,235,180,.12);
      --blur:22px;
      --radius:18px;
      --dock-space:84px;
      --maxw:980px;
    }

    /* Base */
    html,body{height:100%;margin:0}
    html{background:var(--bg)}
    body{
      background:var(--bg); /* s√≥lido, sem gradiente */
      color:var(--fg);
      font-family:ui-rounded,system-ui,-apple-system,Inter,Segoe UI,Roboto,Arial;
      min-height:100vh;
      min-height:100svh; /* mobile moderno */
    }

    /* Header */
    .header{
      position:sticky;top:0;z-index:10;
      backdrop-filter:blur(var(--blur)) saturate(150%);
      background:rgba(0,0,0,.45);
      border-bottom:1px solid var(--stroke);
      box-shadow:0 12px 34px rgba(0,0,0,.42);
      padding-top:env(safe-area-inset-top)
    }
    .inner{max-width:var(--maxw);margin:0 auto;padding:14px;display:flex;gap:14px;align-items:center}
    .logo{width:46px;height:46px;border-radius:50%;display:inline-grid;place-items:center;position:relative;background:rgba(0,0,0,.25)}
    .ring{position:absolute;inset:0;border:2px solid var(--acc);border-radius:50%;animation:spin 6s linear infinite}
    .bar{position:absolute;left:50%;top:50%;width:60%;height:2px;background:var(--acc);transform:translate(-50%,-50%);border-radius:999px;animation:breathe 2.4s ease-in-out infinite}
    @keyframes spin{to{transform:rotate(360deg)}}
    @keyframes breathe{0%,100%{opacity:.8}50%{opacity:1}}
    h1{font-size:1.16rem;margin:.12rem 0 0;font-weight:800}
    .kicker{font-size:.72rem;letter-spacing:.16em;color:#e0e0e0;text-transform:uppercase}

    /* Toolbar (filtro/contador opcional) */
    .toolbar{max-width:var(--maxw);margin:10px auto 0;padding:0 14px 4px;display:flex;gap:10px;align-items:center;opacity:.92}
    .pill{border:1px solid var(--stroke-soft);border-radius:999px;padding:.5rem .8rem;background:rgba(255,255,255,.04);font-weight:700}

    /* Section */
    .section{max-width:var(--maxw);margin:14px auto 6px;padding:0 14px}
    .section h2{
      font-size:.92rem;letter-spacing:.12em;text-transform:uppercase;
      color:#e6e6e6;margin:14px 0 8px;opacity:.9
    }

    /* Grid/cards */
    .grid{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:14px}
    @media(max-width:560px){.grid{grid-template-columns:1fr}}
    .card{
      background:rgba(0,0,0,.32);
      border:1px solid var(--stroke-soft);
      border-radius:18px;
      padding:12px;
      display:flex;gap:12px;align-items:center;
      box-shadow:0 6px 18px rgba(0,0,0,.45)
    }
    .icon{width:56px;height:56px;border-radius:14px;display:grid;place-items:center;overflow:hidden;background:#0f1320;border:1px solid var(--stroke-soft)}
    .icon img{width:100%;height:100%;object-fit:cover;display:block}
    .title{font-weight:800;margin-bottom:2px}
    .muted{color:var(--muted);font-size:.86rem}
    .row{margin-top:8px}
    .btn{appearance:none;border:1px solid var(--stroke-soft);cursor:pointer;background:rgba(255,255,255,.06);color:#fff;padding:.64rem .9rem;border-radius:999px;font-weight:800}
    .btn.primary{background:linear-gradient(90deg,#9f7cff,#29d3ff);border-color:transparent}

    /* Bottom Dock */
    .dock{position:fixed;left:0;right:0;bottom:0;z-index:30;display:block}
    .dock-inner{
      max-width:var(--maxw);margin:0 auto;
      padding:8px 10px calc(8px + env(safe-area-inset-bottom));
      display:flex;gap:8px;justify-content:space-between;align-items:center;
      backdrop-filter:blur(18px) saturate(140%);
      background:rgba(0,0,0,.50);
      border-top:1px solid var(--stroke);
      box-shadow:0 -10px 30px rgba(0,0,0,.45)
    }
    .dbtn{appearance:none;border:1px solid var(--stroke);background:rgba(255,255,255,.06);color:#fff;padding:.64rem .9rem;border-radius:12px;font-weight:700}
    footer{color:#fff;font-size:.8rem;text-align:center;margin:18px 0 calc(18px + var(--dock-space));opacity:.9}

    /* Espa√ßo pra dock (quando grid √∫nico) */
    .spacer{height:calc(var(--dock-space) + env(safe-area-inset-bottom) + 8px)}
  </style>
</head>
<body>
  <header class="header">
    <div class="inner">
      <span class="logo" aria-hidden="true"><span class="ring"></span><span class="bar"></span></span>
      <div style="flex:1">
        <div class="kicker">Infodose ‚Ä¢ Hub Principal</div>
        <h1>Infodose Hub Ultra</h1>
      </div>
      <nav aria-label="Instalar">
        <button class="btn primary" id="btnInstall" type="button">‚¨áÔ∏è Instalar</button>
      </nav>
    </div>
  </header>

  <div class="toolbar">
    <div class="pill" id="countApps">Carregando‚Ä¶</div>
  </div>

  <!-- Sections ser√£o injetadas -->
  <main id="content"></main>

  <footer>Infodose Hub Ultra ‚Ä¢ PWA</footer>

  <div class="dock" role="navigation" aria-label="Dock">
    <div class="dock-inner">
      <button class="dbtn" id="dockHome" type="button">Home</button>
      <button class="dbtn" id="dockInfodose" type="button">Infodose</button>
      <button class="dbtn" id="dockInstall" type="button">Instalar</button>
    </div>
  </div>

  <script>
  const $ = (q,root=document)=>root.querySelector(q);

  // √çcones por tipo (voc√™ j√° tem os PNGs)
  const DEFAULT_ICONS = {
    base:   'icons/icon-192.png',
    chats:  'icons/icon-192-chats.png',
    editors:'icons/icon-192-editors.png',
    indexrs:'icons/icon-192-indexrs.png'
  };

  const GROUP_TITLES = {
    index_hubs: 'Index / Hubs',
    chats: 'Chats / Render',
    editors_tools: 'Editors & Tools',
    menus: 'Menus',
    tutorials: 'Tutoriais',
    visual_splash: 'Visual / Splash',
    docs: 'Docs',
    players: 'Players'
  };

  const GROUP_ICON_MAP = {
    index_hubs: DEFAULT_ICONS.indexrs,
    chats: DEFAULT_ICONS.chats,
    editors_tools: DEFAULT_ICONS.editors,
    menus: DEFAULT_ICONS.editors,
    tutorials: DEFAULT_ICONS.base,
    visual_splash: DEFAULT_ICONS.base,
    docs: DEFAULT_ICONS.base,
    players: DEFAULT_ICONS.base
  };

  // Ordem de exibi√ß√£o
  const GROUP_ORDER = [
    'index_hubs','chats','editors_tools','menus','tutorials','visual_splash','docs','players'
  ];

  function pickIcon(app, groupKey){
    if (app.icon && app.icon.trim()) return app.icon;
    return GROUP_ICON_MAP[groupKey] || DEFAULT_ICONS.base;
  }

  function renderFlat(apps){
    const content = $('#content');
    content.innerHTML = '';
    const sec = document.createElement('section');
    sec.className = 'section';
    sec.innerHTML = `<h2>Aplicativos</h2><div class="grid" id="gridFlat"></div>`;
    content.appendChild(sec);
    const grid = $('#gridFlat');
    apps.forEach(app => grid.appendChild(card(app, null)));
  }

  function sectionWrap(title, key){
    const sec = document.createElement('section');
    sec.className = 'section';
    sec.dataset.group = key;
    sec.innerHTML = `<h2>${title}</h2><div class="grid"></div>`;
    return sec;
  }

  function card(app, groupKey){
    const el = document.createElement('div');
    el.className = 'card';
    const iconSrc = pickIcon(app, groupKey);
    el.innerHTML = `
      <div class="icon">
        <img src="${iconSrc}" alt="">
      </div>
      <div style="flex:1">
        <div class="title">${app.title || app.key}</div>
        <div class="muted">${app.desc || ''}</div>
        <div class="row">
          <button class="btn" type="button">Abrir</button>
        </div>
      </div>
    `;
    el.querySelector('.btn').addEventListener('click', () => {
      if(app.url) window.open(app.url,'_blank','noopener');
    });
    return el;
  }

  async function loadApps(){
    try{
      const res = await fetch('./apps/apps.json', {cache:'no-store'});
      const data = await res.json();

      const content = $('#content');
      content.innerHTML = '';

      // Se vier agrupado
      if (data.groups && typeof data.groups === 'object'){
        let total = 0;
        GROUP_ORDER.forEach(gk=>{
          const list = data.groups[gk];
          if(Array.isArray(list) && list.length){
            total += list.length;
            const sec = sectionWrap(GROUP_TITLES[gk] || gk, gk);
            const grid = sec.querySelector('.grid');
            list.forEach(app => grid.appendChild(card(app, gk)));
            content.appendChild(sec);
          }
        });
        // quaisquer grupos extras fora da ordem:
        Object.keys(data.groups).forEach(gk=>{
          if(!GROUP_ORDER.includes(gk)){
            const list = data.groups[gk];
            if(Array.isArray(list) && list.length){
              total += list.length;
              const sec = sectionWrap(GROUP_TITLES[gk] || gk, gk);
              const grid = sec.querySelector('.grid');
              list.forEach(app => grid.appendChild(card(app, gk)));
              content.appendChild(sec);
            }
          }
        });
        $('#countApps').textContent = `${total} itens organizados`;
      }
      // Se vier plano
      else if (Array.isArray(data.apps)){
        $('#countApps').textContent = `${data.apps.length} itens`;
        renderFlat(data.apps);
      } else {
        throw new Error('Formato de apps.json n√£o reconhecido.');
      }

      // Espa√ßo pra dock ao final (quando sec√ß√µes curtas)
      const spacer = document.createElement('div');
      spacer.className = 'spacer';
      content.appendChild(spacer);

    }catch(e){
      const content = $('#content');
      content.innerHTML = `
        <section class="section">
          <div class="card">
            <div class="icon">‚ö†Ô∏è</div>
            <div>
              <div class="title">Falha ao carregar apps</div>
              <div class="muted">apps/apps.json n√£o encontrado ou inv√°lido.</div>
            </div>
          </div>
        </section>
      `;
      $('#countApps').textContent = 'Erro no apps.json';
    }
  }
  loadApps();

  // Dock actions
  $('#dockHome').addEventListener('click', ()=>{
    window.scrollTo({top:0, behavior:'smooth'});
    history.pushState('', document.title, window.location.pathname + window.location.search);
  });
  $('#dockInfodose').addEventListener('click', ()=>{
    window.open('https://infodose.com.br','_blank','noopener');
  });

  // PWA install
  if('serviceWorker' in navigator){
    window.addEventListener('load', ()=> {
      navigator.serviceWorker.register('./sw.js').catch(()=>{});
    });
  }
  let deferredPrompt=null;
  window.addEventListener('beforeinstallprompt', (e)=>{ e.preventDefault(); deferredPrompt=e; });
  async function doInstall(){
    if(deferredPrompt){ deferredPrompt.prompt(); await deferredPrompt.userChoice; deferredPrompt=null; }
    else alert('Use ‚ÄúAdicionar √† Tela de In√≠cio‚Äù.');
  }
  $('#btnInstall').addEventListener('click', doInstall);
  $('#dockInstall').addEventListener('click', doInstall);
  </script>
</body>
</html>
